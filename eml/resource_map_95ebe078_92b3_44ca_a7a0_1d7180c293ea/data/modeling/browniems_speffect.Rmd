---
title: "Pilot two-season banding program to estimate seasonal survival rates and test hypotheses of population regulation"
author: Patrick K. Devers, Robert L. Emmet, G. Scott Boomer, Guthrie Zimmerman, J. Andrew Royle
date: "March 4, 2020"
output:
  word_document:
    fig_caption: yes
editor_options:
  chunk_output_type: console
bibliography: C:/Users/Robbie/Desktop/wolverines/results_and_writing/thesis/library.bib
---

```{r setup, include=FALSE}
some_stuff <- T
on_laptop <- T
library(knitr)
knitr::opts_chunk$set(echo = F, cache = T, warning = F, message=F, results = "hide", cache.path = ifelse(on_laptop, "C:/Users/Robbie/Desktop/dissertation/browniecache/", "C:/Users/remmet/Desktop/browniecache"), fig.width = 6, fig.height = 9, fig.path = ifelse(on_laptop, "C:/Users/Robbie/Desktop/dissertation/blackducks/figures/", "C:/Users/remmet/Desktop/blackducks/figures/"))
```

# Abstract
1. [Context and need for the work]
2. [Approach and methods used]
3. [Main results]
4. [Main results continued, if needed]
5. [Synthesis and applications]
6. [Synthesis and applications, continued, if needed

# keywords
American black duck, *Anas platyrhynchos*, *Anas rubripes*, banding, mallard, population regulation, seasonal survival, winter

# Introduction
The goals of North American waterfowl management are to ensure the future sustainability of waterfowl populations and provide recreational opportunities, including sport harvest. To meet these goals managers and researchers require information about the abundance and distribution of populations and vital rates (i.e., survival and mortality rates). Over the past 2-3 decades researchers and managers have been most interested in obtaining information on annual survival and harvest rates and have relied on a coordinated single-season banding program occurring prior to the hunting season (i.e., pre-season; July-September) and reports of harvested birds (i.e., encounters) because it is the most efficient design to estimate recovery rates [@Brownie1985; @Nichols1987]. However, single-season banding operations have a number of characteristics that limit their application to estimating demographic rates and evaluating potential limiting factors. First, pre-season banding is not the most logistically or financially efficient season to trap some species of North America ducks, such as the American black ducks (*Anas rubripes*; hereafter black ducks). Pre-season banding of black ducks is difficult because black ducks are distributed in low densities across the boreal and hardwood forests of eastern North America [@Blandin1982; Fig. 1 Annual range map?]. Second, single-season banding programs do not provide information about seasonal survival rates, and thus limit the ability of researchers and managers to model and contrast alternative hypotheses of population regulation (e.g., density dependent reproduction vs. density dependent seasonal survival). This second limitation is particularly important because successful conservation requires increased understanding of the linkages between habitat quality and quantity, and population limiting factors [@Anderson2007]. Finally, predictions of large-scale landscape and system changes (e.g., climate change) may influence waterfowl populations in ways not experienced or anticipated by current habitat and harvest management programs. Therefore, waterfowl managers may sometimes need finer temporal or spatial resolution estimates of vital rates than single-season banding programs can provide.        
The American black duck has been identified as a priority species because of its importance to hunters in eastern North America and because the population experienced a long-term decline between the 1950s and 1990s resulting in a population reduction of approximately 50% as measured by the mid-winter inventory [@Conroy2002]. Researchers and managers have proposed a variety of hypotheses to explain the historic decline of the black duck population including over-harvest, competition and hybridization with mallards (*A. platyrhynchos*), decrease in the quantity and quality of breeding habitat, and decrease in the quantity and quality of non-breeding habitat [@Conroy1989; @Longcore2000b; @Conroy2002; @Zimpfer2006; @Rusch1989; @Nudds1996; @McAuley2004]. Currently, black duck managers and researchers posit the black duck population is regulated according to one of three hypotheses:  

a.	the black duck population is limited by density-dependent productivity conditional on the quantity and quality of breeding habitat;  
b.	the black duck population is limited by density-dependent productivity conditional on the quantity and quality of non-breeding habitat; and  
c.	the black duck population is limited by density-dependent winter (i.e., January-March) survival conditional on the quality and quantity of non-breeding habitat.    

Pre-hunting season banding programs provide limited data to estimate seasonal survival rates or relate annual variation in seasonal survival to habitat and environmental conditions. This lack of information limits the ability of managers to evaluate support for these competing hypotheses or implement effective population and habitat management plans. The Black Duck Joint Venture (BDJV), in partnership with the U.S. Fish and Wildlife Service, Canadian Wildlife Service and Provincial and State Wildlife Agencies in the Atlantic and Mississippi Flyways, initiated a pilot 2-season banding program to improve our ability to model black duck population dynamics and identify limiting factors. The objectives of the pilot program were:  

a.	Design a two-season banding program using historical data;  
b.	Estimate survival and recovery rates and test model assumptions;  
c.	Compare survival and recovery rates among black ducks, mallards, and hybrids;  
d.	Evaluate the potential of a 2-season banding program to improve the ability of researchers and managers to contrast support among competing hypotheses;   
e.	Use the results of the pilot study to revise field and analytical protocols and make recommendations for implementing an operational 2-season banding program.

# Materials and Methods
```{r change_for_repro, cache = F}
#### Define things that will change on different computers here ####
if(on_laptop){
datarepo <- "C:/Users/Robbie/Desktop/dissertation/data/"
githubrepo <- "C:/Users/Robbie/Desktop/dissertation/blackducks/"
} else {
  datarepo <- "C:/Users/remmet/Desktop/blackduckdata/"
githubrepo <- "C:/Users/remmet/Desktop/blackducks/"
}
setwd(githubrepo)
JAGSMdl<-paste(readLines("jagsfiles/AgeSex_2season_annS.txt"),collapse="\n")
JAGSMdlpreSS<-paste(readLines("jagsfiles/AgeSex_1seasonpre_annS.txt"),collapse="\n")
JAGSMdlpostSS<-paste(readLines("jagsfiles/AgeSex_1seasonpost_annS.txt"),collapse="\n")
JAGSMdlRanEff <- paste(readLines("jagsfiles/AgeSex_2season_annS_raneff.txt"),collapse="\n")
JAGSMdlSpEffect <- paste(readLines("jagsfiles/AgeSex_2season_annS_spEffect_Small.txt"),collapse="\n")
JAGSMdlPreSpEffect <- paste(readLines("jagsfiles/AgeSex_1seasonpre_annS_spEffect.txt"),collapse="\n")
JAGSMdlPostSpEffect <- paste(readLines("jagsfiles/AgeSex_1seasonpost_annS_spEffect.txt"),collapse="\n")
pooledH <- T
notpooledH <- !pooledH
# Load sim and plotting functions!!!
source("functions/runBrownie.R")
source("functions/plotAndSums.R")
source("functions/runSingleSeasonBrownie.R")
source("functions/plotAndSumsSS.R")
# Add raneff function if you use it
source("functions/runBrownieRanEff.R")
source("functions/runBrownieSpEffect.R")
source("functions/runSingleSeasonBrownieSpEffect.R")
source("functions/plotAndSumsSpEffect.R")
```

```{r subset_data}
#### Load data, re-name variables ####
band.1 <- read.csv(paste0(datarepo,"bndg_req_PatDevers_11062018.csv"))
enc.3 <- read.csv(paste0(datarepo,"enc_req_PatDevers_11062018.csv"))
# For matching state names and codes
regions <- read.csv(paste0(datarepo,"BAREAS and Regions.csv"))
# Change 1 - I think the column names between regions and band/enc files are different. In the region.csv file, Bregion is the numeric # state code (e.g., PA = 78), but in the regions.csv file Bregion refers to the larger breeding/wintering areas (e.g., North Atlantic # # wintering region). On local file I used the following code to rectify.
colnames(regions) <- c("State","Bregion", "Barea", "Eregion", "Earea")

# Rename banding data variables to match Pat's code
names(band.1)[which(names(band.1)=="BYEAR")] <- "BYEAR"
# Change 2 - commented out line below.
#names(band.1)[which(names(band.1)=="ENCOUNTER_YEAR")] <- "Hyear" # Which is Bseason? conditional on banding month?
names(band.1)[which(names(band.1)=="AREA_CODE")] <- "Bregion" # or is it flyway that becomes Bregion?
names(band.1)[which(names(band.1)=="AGE_CODE")] <- "Age"
names(band.1)[which(names(band.1)=="SEX_CODE")] <- "Sex"
names(band.1)[which(names(band.1)=="ORIGINAL_BAND")] <- "Orig_Band"
names(band.1)[which(names(band.1)=="BIRD_STATUS")] <- "Bird_Status"
names(band.1)[which(names(band.1)=="EXTRA_INFO_CODE")] <- "ExInfo"
names(band.1)[which(names(band.1)=="FLYWAY_CODE")] <- "BFlyway"

# Rename encounter data variables
# Change 3 - commented out line below
#names(enc.3)[which(names(enc.3)=="ENCOUNTER_YEAR")] <- "Hyear"
names(enc.3)[which(names(enc.3)=="BANDING_YEAR")] <- "BYEAR"
#names(enc.3)[which(names(enc.3)=="E_COUNTY_CODE")] <- "Ecount" # county or country?
#names(enc.3)[which(names(enc.3)=="enc.3OUNTER_YEAR")] <- "Hyear" # Which is Bseason? conditional on banding month?
names(enc.3)[which(names(enc.3)=="BAREA_CODE")] <- "Bregion" # or is it flyway that becomes Bregion?
names(enc.3)[which(names(enc.3)=="AGE_CODE")] <- "Age"
names(enc.3)[which(names(enc.3)=="SEX_CODE")] <- "Sex"
names(enc.3)[which(names(enc.3)=="ORIG_BAND_ID")] <- "Orig_Band"
names(enc.3)[which(names(enc.3)=="BIRD_STATUS")] <- "Bird_Status"
names(enc.3)[which(names(enc.3)=="EXTRA_INFO_CODE")] <- "ExInfo" # Not sure about this one either
names(enc.3)[which(names(enc.3)=="BFLYWAY")] <- "BFlyway"
names(enc.3)[which(names(enc.3)=="ENCOUNTER_MONTH")] <- "Emon"

# Change 4 - added new code to create the harvest year variable (Hyear)
enc.3$Hyear <- ifelse(enc.3$Emon %in% c(1) & enc.3$HOW_OBTAINED_CODE %in% c(0,1),enc.3$ENCOUNTER_YEAR - 1, enc.3$ENCOUNTER_YEAR)
# OK good. N.B.: Hyear is the year the hunting season starts not the calendar year the bird is shot (e.g. if it's shot in January)

# Create Ecount variable, in encounter data only??
enc.3$Ecount <- 1

# Missing still: Bseason
# Create Bseason in both banding and encounter data
# Change 4 - add January bandings to post season
band.1$BSeason <- ifelse(band.1$BMON %in% c(7,8,9), "Pre", ifelse(band.1$BMON %in% c(1,2) | (band.1$BMON==3 & band.1$BDAY <= 10), 
 "Post", "Other" ))

# Change 5 - add code to inlcude all birds banded in January following the end of the hunting season. The last day of hunting varied  #each year (last Sunday in January). I exclude all post-season banding in 2009. The code below is not efficient, but it does the job #for now. If we want to clean it up that is OK with me.
# tmp <- subset(band.1, !(band.1$BYEAR==2009 & band.1$BMON<7 ))
# tmp1 <- subset(tmp,  !(tmp$BYEAR==2011  & tmp$BMON==1 & tmp$BDAY < 31))
# tmp2 <- subset(tmp1, !(tmp1$BYEAR==2012 & tmp1$BMON==1 & tmp1$BDAY < 30))
# tmp3 <- subset(tmp2, !(tmp2$BYEAR==2013 & tmp2$BMON==1 & tmp2$BDAY < 28))
# tmp4 <- subset(tmp3, !(tmp3$BYEAR==2014 & tmp3$BMON==1 & tmp3$BDAY < 27))
# tmp5 <- subset(tmp4, !(tmp4$BYEAR==2015 & tmp4$BMON==1 & tmp4$BDAY < 26))
# tmp6 <- subset(tmp5, !(tmp5$BYEAR==2017 & tmp5$BMON==1 & tmp5$BDAY < 30))
# tmp7 <- subset(tmp6, !(tmp6$BYEAR==2018 & tmp6$BMON==1 & tmp6$BDAY < 29))
# tmp8 <- subset(tmp7, !(tmp7$BYEAR==2010 & tmp7$BMON==1 & tmp7$BDAY <= 31))
# tmp9 <- subset(tmp8, !(tmp8$BYEAR==2016 & tmp8$BMON==1 & tmp8$BDAY <= 31))
# band.1<-tmp9

# Change 6 - add january bandings to post season 
enc.3$BSeason <- ifelse(enc.3$BANDING_MONTH %in% c(7,8,9), "Pre", ifelse(enc.3$BANDING_MONTH %in% c(1,2) | (enc.3$BANDING_MONTH==3 & enc.3$BANDING_DAY <= 10), "Post", "Other" ))

# Change 7 - add code to include all birds banded in January following the end of the hunting season. 
# tmp <- subset(enc.3, !(enc.3$BYEAR==2009 & enc.3$BANDING_MONTH<7 ))
# tmp1 <- subset(tmp,  !(tmp$BYEAR==2011  & tmp$BANDING_MONTH==1 & tmp$BANDING_DAY < 31))
# tmp2 <- subset(tmp1, !(tmp1$BYEAR==2012 & tmp1$BANDING_MONTH==1 & tmp1$BANDING_DAY < 30))
# tmp3 <- subset(tmp2, !(tmp2$BYEAR==2013 & tmp2$BANDING_MONTH==1 & tmp2$BANDING_DAY < 28))
# tmp4 <- subset(tmp3, !(tmp3$BYEAR==2014 & tmp3$BANDING_MONTH==1 & tmp3$BANDING_DAY < 27))
# tmp5 <- subset(tmp4, !(tmp4$BYEAR==2015 & tmp4$BANDING_MONTH==1 & tmp4$BANDING_DAY < 26))
# tmp6 <- subset(tmp5, !(tmp5$BYEAR==2017 & tmp5$BANDING_MONTH==1 & tmp5$BANDING_DAY < 30))
# tmp7 <- subset(tmp6, !(tmp6$BYEAR==2018 & tmp6$BANDING_MONTH==1 & tmp6$BANDING_DAY < 29))
# tmp8 <- subset(tmp7, !(tmp7$BYEAR==2010 & tmp7$BANDING_MONTH==1 & tmp7$BANDING_DAY <= 31))
# tmp9 <- subset(tmp8, !(tmp8$BYEAR==2016 & tmp8$BANDING_MONTH==1 & tmp8$BANDING_DAY <= 31))
# enc.3<-tmp9


#### Start of Pat's code ####
enc.4<-subset(enc.3,enc.3$Hyear<2018 & enc.3$HOW_OBTAINED_CODE %in% c(0,1))
full<-merge(band.1,enc.4,by=c("Orig_Band","BYEAR", "Bregion", "Age", "Sex", "Bird_Status", "ExInfo", "BFlyway", "BSeason"),all.x=TRUE)
# create new variables: direct recoveries (1=yes, 0=no)
full$Direct<-ifelse(full$BYEAR==full$Hyear,1,0)
full$Direct[is.na(full$Direct)]<-0
full$Ecount[is.na(full$Ecount)]<-0
full$Group <-paste0(full$BSeason,full$Bregion,collapse=NULL)
full$age<-ifelse(full$Age %in% c(2:4),"J",
                 ifelse(full$Age %in% c(1,6:8),"A",
                        ifelse(full$Age == 5,"SY","Unk"))) # 2,4 are HY and local, 1,6,8 are AHY, after second year, after third year
full$sex<-ifelse(full$Sex %in% c(4,6), "M",
                 ifelse(full$Sex %in% c(5,7),"F","Unk"))

full$cohort <- paste(full$age,full$sex,sep="")
full$BSTAT <- (full$Bird_Status *100)+full$ExInfo
# Add state variable
# Change 8 - add to tweek this code due to change 1
 full <- merge(full,regions[,1:3], by.x = "Bregion", by.y = "Bregion")
 full$Bregion <- as.numeric(full$Bregion)
 # Change 8A (RLE) - commented out second merge and edited first so only banding area/region code columns are included. Will double-check what this does
 #full <- merge(full, regions[,1:2], by.x = "Bregion", by.y = "Bregion")

# Add species variable Spp
speciescodes <- data.frame(SPECIES_ID.x = c(1320,1325,1326,1327,1330,1337),Spp=c("MALL", "MBDX", "MBDH", "MALX", "ABDU", "ABDX"))

full <- merge(full, speciescodes, by = "SPECIES_ID.x", all.x = TRUE)

# Convert State and Barea from factors to characters
full$Barea<-as.character(full$Barea)
full$State<-as.character(full$State)

# Subset out some black ducks
# Change 9 - please check this code and make sure it is working correctly. I had to change the varialbe from Bregion to Barea due to # change 1
full$Barea<-ifelse(full$State=="PA" & full$BLON_FLOAT < -79.000, "MISS",full$Barea)
#full$Bregion<-ifelse(full$State=="PA" & full$BLON_FLOAT < -79.000 & full$BFlyway==1,"MISS",full$Bregion)

# Subset out:
# Mallards banded in Ontario
# Mallards banded in Atlantic Flyway and recovered in MISS Flyway states
# Mallards banded in MISS flyway states
full$MallOnt <- ifelse(full$Spp %in% c("MALL", "MALX", "MBDH", "MBDX") & full$Bregion==68, 1, 0)
# Change 10 - we should include all mallards and hybrids banded in the Atlantic Flyway regardless of where they area harvested. This # #might need to change for the multi-state framework.
#full$MallAtlms <- ifelse(full$Spp %in% c("MALL", "MALX", "MBDH", "MBDX") &
#                           full$BFlyway==1 & 
#                           full$E_AREA_CODE %in% 
#                           c(50,91,49,36,34,35,66,52,39,82,7,42,51,2,
#                             04,11,40,43,45,79,93), 1, 0)
# Change 11 - keep all ABDU
#full$Abdums <- ifelse(full$Bregion=="MISS" & full$Spp %in% c("ABDU", "ABDX"), 1, 0)

# Change 12 - a slightly more efficient way to do this is to use BFLYWAY instead of Bregion
full$Mallms <- ifelse(full$Spp %in% c("MALL", "MALX", "MBDH", "MBDX") & full$BFlyway == 2,1,0) # This will be MALL banded in MISS #Flyway states
#full$Mallms <- ifelse(full$Spp %in% c("MALL", "MALX", "MBDH", "MBDX") & full$Bregion %in% 
#          c(50,91,49,36,34,35,66,52,39,82,7,42,51,2,
#            04,11,40,43,45,79,93), 1, 0) # This will be MALL banded in MISS flyway states (and provinces?)


#Change 13 - keep MS ABDU
full.east <- subset(full,full$MallOnt == 0 & full$Mallms == 0)
#full.east <- subset(full, full$MallOnt==0 & full$MallAtlms==0 & full$Abdums==0 & full$Mallms==0)


#### Subset further?
#### create cohort specific datasets - Adult Male ####
#full.2 <- subset(full,full$BSTAT %in% c(300,303,304,370) &
#                   full$EMon %in% c(1,9,10,11,12,93,94,NA))

full.2 <- full.east[which(full.east$BSTAT %in% c(300,304,370) & full.east$Emon %in% c(1,9,10,11,12,93,94,NA)),]



# check for birds banded in post season and harvest in the same year
full.2$check <- ifelse(full.2$Ecount==1 & full.2$BYEAR>full.2$Hyear, 1,0) # Should that be ==?
full.2 <-subset(full.2,check==0)

# Getting rid of duplicates
full.2 <- full.2[order(full.2$SRC.y, full.2$ENC_DATE),]
# This puts DB records first, then sorts so earliest date is first if both are HF
# This means if one of the duplicates is unclear day or month, that one is deleted, FYI
#dupIDs <- full.2$Orig_Band[which(duplicated(full.2$Orig_Band))]
#dup.encs <- full.2[which(full.2$Orig_Band %in% dupIDs),]
#dup.encs2 <- dup.encs[order(dup.encs$Orig_Band),]
#dup.encs3 <- dup.encs[-which(duplicated(dup.encs$Orig_Band)),]
full.2 <- full.2[-which(duplicated(full.2$Orig_Band)),]
#full.2$BYEAR <- as.factor(full.2$BYEAR) # This ensures that m-arrays include all years
#full.2$Hyear <- as.factor(full.2$Hyear)
```


```{r summary_banding_tables}
# Change 14
### Summarize the number of bands (by species) and year and season ###
# The purpose of this code is simply to summarize banding and sample sizes compared the design.
# again this is sloppy code and if we want to clean it up we can do so.
full.2$Bcount <- 1
full.2$SPP <- ifelse(full.2$SPECIES_ID.x==1330,"ABDU",
                         ifelse(full.2$SPECIES_ID.x==1320,"MALL","HYBR"))

# Average number of total ABDU bandings included in the anlaysis.
tmp <- full.2
tmp <- subset(tmp,tmp$BSeason %in% c("Pre","Post") & tmp$SPP == "ABDU")
BandTable <- as.data.frame(table(tmp$BYEAR,tmp$BSeason))
  colnames(BandTable) <- c("BYEAR","BSeason","Included")
  library(reshape)
  BandTable2.abdu <- BandTable2 <- reshape(BandTable, direction ='wide',idvar='BYEAR',timevar = 'BSeason')

  # Spatial allocation of pre-season banded birds used in the analysis
  pre.band<-subset(tmp,tmp$BSeason=="Pre" & tmp$BYEAR < 2018)
    pre.band.table <- as.data.frame(table(pre.band$BYEAR,pre.band$Barea))
    colnames(pre.band.table)<-c("BYEAR","Barea","Banded")
    pre.band.table$BYEAR <- as.character(pre.band.table$BYEAR)
    pre.band.table2 <- reshape(pre.band.table, direction='wide',idvar='BYEAR', timevar = 'Barea')
    pre.band.table2 <- pre.band.table2[,c(1,2,5,6)]
    pre.band.table2[10,1] <- "total"
    pre.band.table2[10,2] <- sum(pre.band.table2[1:9,2])
    pre.band.table2[10,3] <- sum(pre.band.table2[1:9,3])
    pre.band.table2[10,4] <- sum(pre.band.table2[1:9,4])
    pre.band.table2$Annual <- 0
    pre.band.table2$Prop.MAR <- 0
    pre.band.table2$Prop.ONT <- 0
    pre.band.table2$Prop.QUE <- 0
   for (i in 1:10){
      pre.band.table2[i,5]<-sum(pre.band.table2[i,2:4])
      pre.band.table2[i,6] <- pre.band.table2[i,2]/pre.band.table2[i,5]
      pre.band.table2[i,7] <- pre.band.table2[i,3]/pre.band.table2[i,5]
      pre.band.table2[i,8] <- pre.band.table2[i,4]/pre.band.table2[i,5]
    }
# Spatial allocation of post-season banded birds used in the analysis
    post.band<-subset(tmp,tmp$BSeason=="Post" & tmp$BYEAR %in% c(2010:2017))
    post.band.table <- as.data.frame(table(post.band$BYEAR,post.band$Barea))
    colnames(post.band.table)<-c("BYEAR","Barea","Banded")
    post.band.table$BYEAR <- as.character(post.band.table$BYEAR)
   
   post.band.table2 <- reshape(post.band.table, direction='wide',idvar='BYEAR', timevar = 'Barea')
    post.band.table2[9,1] <- "total"
    
    post.band.table2[9,2] <- sum(post.band.table2[1:8,2])
    post.band.table2[9,3] <- sum(post.band.table2[1:8,3])
    post.band.table2[9,4] <- sum(post.band.table2[1:8,4])
    post.band.table2[9,5] <- sum(post.band.table2[1:8,5])
    post.band.table2[9,6] <- sum(post.band.table2[1:8,6])
   
    post.band.table2$Annual     <- 0
    post.band.table2$Prop.MAR   <- 0
    post.band.table2$Prop.MISS  <- 0
    post.band.table2$Prop.NATL  <- 0
    post.band.table2$Prop.ONT   <- 0
    post.band.table2$Prop.SATL  <- 0
   
    for (i in 1:9){
      post.band.table2[i,7]<-sum(post.band.table2[i,2:6])
      post.band.table2[i,8] <- post.band.table2[i,2]/post.band.table2[i,7]
      post.band.table2[i,9] <- post.band.table2[i,3]/post.band.table2[i,7]
      post.band.table2[i,10] <- post.band.table2[i,4]/post.band.table2[i,7]
      post.band.table2[i,11] <- post.band.table2[i,5]/post.band.table2[i,7]
      post.band.table2[i,12] <- post.band.table2[i,6]/post.band.table2[i,7]
    }
  
  
### tally # ABDU bands without subsetting
#abdu <- read.csv(paste0(datarepo,"bndg_req_PatDevers_11062018.csv"))
abdu <- subset(band.1, band.1$SPECIES_ID == 1330 & band.1$BMON%in% c(1,2,3,7,8,9))
abdu$count<-1
abdu$BSeason <- ifelse(abdu$BMON%in% c(1,2,3),"Post","Pre")
CaptureTable <-as.data.frame(table(abdu$BYEAR,abdu$BSeason))
  colnames(CaptureTable) <- c("BYEAR","BSeason","Total") 
  CaptureTable2.abdu <- CaptureTable2 <- reshape(CaptureTable, direction = 'wide', idvar = 'BYEAR', timevar = "BSeason")
  
SampleSize <- cbind(CaptureTable2,BandTable2)
  SampleSize <- SampleSize[,c(1,2,5,3,6)]
  colnames(SampleSize) <- c("Year","Banded (post)","Used (post)", "Banded (pre)", "Used (pre)")
  # limit data to pre-2009 to pre-2017
  SampleSize <- SampleSize[1:9,]
    mean_post_bands<-mean(SampleSize[2:9,2])
    mean_post_used <-mean(SampleSize[2:9,3])
 
# Average number of mallards and hybrids included in the analysis          
mall.hyb <- subset(full.2,full.2$BSeason %in% c("Pre","Post") & full.2$SPP %in% c("MALL","HYBR"))
mall.hyb.table <- as.data.frame(table(mall.hyb$BYEAR,mall.hyb$BSeason,mall.hyb$SPP))
  colnames(mall.hyb.table) <- c("BYEAR","BSeason","SPP","# Bands")

#library(reshape)
mall.hyb.table2 <- reshape(mall.hyb.table, direction ='wide',idvar=c('SPP','BYEAR'),timevar = 'BSeason') 
  mean.hyb.pre<-mean(mall.hyb.table2[1:9,4]);mean.hyb.post<-mean(mall.hyb.table2[2:9,3])
  mean.mall.pre<-mean(mall.hyb.table2[11:19,4]);mean.mall.post<-mean(mall.hyb.table2[12:19,3])
#######

## Mallard and hybrid code for Table 3
## Mallard
tmp <- full.2
tmp <- subset(tmp,tmp$BSeason %in% c("Pre","Post") & tmp$SPP == "MALL")
BandTable <- as.data.frame(table(tmp$BYEAR,tmp$BSeason))
  colnames(BandTable) <- c("BYEAR","BSeason","Included")
  #library(reshape)
  BandTable2.mall <- BandTable2 <- reshape(BandTable, direction ='wide',idvar='BYEAR',timevar = 'BSeason')
  
mall <- subset(band.1, band.1$SPECIES_ID == 1320 & band.1$BMON%in% c(1,2,3,7,8,9))
mall$count<-1
mall$BSeason <- ifelse(mall$BMON%in% c(1,2,3),"Post","Pre")
CaptureTable <-as.data.frame(table(mall$BYEAR,mall$BSeason))
  colnames(CaptureTable) <- c("BYEAR","BSeason","Total") 
  CaptureTable2.mall <- CaptureTable2 <- reshape(CaptureTable, direction = 'wide', idvar = 'BYEAR', timevar = "BSeason")
  
## Hybrid
tmp <- full.2
tmp <- subset(tmp,tmp$BSeason %in% c("Pre","Post") & tmp$SPP == "HYBR")
BandTable <- as.data.frame(table(tmp$BYEAR,tmp$BSeason))
  colnames(BandTable) <- c("BYEAR","BSeason","Included")
  #library(reshape)
  BandTable2.hybr <- BandTable2 <- reshape(BandTable, direction ='wide',idvar='BYEAR',timevar = 'BSeason')
  
hybr <- subset(band.1, !(band.1$SPECIES_ID %in% c(1320,1330)) & band.1$BMON%in% c(1,2,3,7,8,9))
hybr$count<-1
hybr$BSeason <- ifelse(hybr$BMON%in% c(1,2,3),"Post","Pre")
CaptureTable <-as.data.frame(table(hybr$BYEAR,hybr$BSeason))
  colnames(CaptureTable) <- c("BYEAR","BSeason","Total") 
  CaptureTable2.hybr <- CaptureTable2 <- reshape(CaptureTable, direction = 'wide', idvar = 'BYEAR', timevar = "BSeason")  
```
## Study Area
The two-season banding program was conducted throughout the black duck's annual range in eastern North America (Fig. 2). Pre-season banding was conducted in Ontario, Quebec, New Brunswick, Nova Scotia, Prince Edward Island, Newfoundland and Labrador. Post-season banding was conducted in Ontario, Newfoundland, Prince Edward Island, New Brunswick, Nova Scotia, Maine, Vermont, Massachusetts, New York, Rhode Island, Connecticut, New Jersey, Pennsylvania, Delaware, Maryland, Virginia, North Carolina, South Carolina, Michigan, Ohio, Kentucky, Tennessee, and Arkansas. We identified 3 pre-season banding regions: Ontario, Quebec, and Atlantic Canada (New Brunswick, Nova Scotia, Prince Edward Island, and Newfoundland and Labrador). We identified 6 post-season banding regions: Ontario, Quebec, Atlantic Canada, northern Atlantic Flyway (Maine, Vermont, New Hampshire, Massachusetts, Rhode Island, New York, Pennsylvania, and New Jersey), southern Atlantic Flyway (Delaware, Maryland, Virginia, North Carolina, and South Carolina), and Mississippi Flyway.  

## Design and power analysis
We used historical black duck banding data (1970-2007) and simulations to identify required sample sizes needed to estimate seasonal survival rates with annual and 5-year mean coefficient of variation (CV) $\leq$ 10\% and $\leq$ 5\%, respectively. We used all normal, wild-caught black ducks in eastern Canada captured during pre-season banding operations and all normal, wild-caught black ducks captured in eastern Canada and the United States during post-season banding operations (February-March). Details regarding selection criteria for banding records are provided in supplemental material X. We used model $H_7$ [@Brownie1985] and historical banding records to estimate the mean, standard error, and CV for survival during the summer/fall (August-January) and winter/spring (February-July) seasons. Next we generated cohort-specific recovery matrices based on expected values with simulated sample sizes of 500-6,000 in increments of 250 for both pre- and post-season allocations. We estimated recovery rate ($f$) and season-specific survival rates ($S^s$) in Program R **(R Core Team  citation)** and calculated corresponding CVs (Fig. 3). In the simulation analysis we assumed quotas were met each year and the same population of birds were banded during pre- and post-season operations.

*Spatial allocation of banding effort*-A key assumption of the Brownie *H_7* model is that the same population is banded during each banding period. We assumed a pre-season allocation equal to the mean proportion of pre-season banding across the 3 Canadian reference areas for the period 1990-2008 (Table 1). We estimated regional post-season banding quotas (i.e., required number of total new banded birds) using published estimates of movement probabilities ($\phi$ [@Zimpfer2006]) among breeding and wintering:

$$
n_{j} = \sum ((N_{i} * c) * \phi_{i,j}
$$

where $n$ is the post-season banding quota for wintering region $j$, $N$ is the pre-season banding quota for breeding region $i$, and $c$ is a constant proportion representing the assumption that 20\% of the breeding population winters in the same breeding region. We assumed birds banded west of 79 (degrees) west longitude in Pennsylvania to be Mississippi Flyway birds due to distribution of hunter-harvested birds in previous years.

For mallards and hybrids, we used only birds banded and recovered in Quebec, Atlantic Canada, and the Atlantic Flyway states. This was due to the presence of mid-continent breeding mallards wintering in the Mississippi Flyway states. We assumed the potential inclusion of mid-continent mallards in the post-season banded sample would violate the assumption of banding the same population during pre- and post-season banding seasons.   

The mean number of black ducks banded annually was 7,105 (6,266 during pre-season and 838 during post-season) for the period 1990-2007. Over this period the age ratio was 0.35 adults and 0.65 juveniles (0.21 adults and 0.73 juveniles in pre-season; 0.91 adults and 0.09 juveniles in post-season). Summaries of state/provincial and regional bandings by month and season since 1970 are provided in Appendix A (as a separate document). The spatial distribution of pre-season bandings was 0.62 in the Atlantic region, 0.21 in Quebec, and 0.17 in Ontario (Table 1).

*Simulation results and sample size*-We estimated seasonal survival rates using banding data from 1970-2007. We use this period because the greatest numbers of post-season bandings occurred in the 1970s. The resulting point estimates and variances were used as input variables into a simulation program to estimate required sample size. Based on the simulation analysis the required sample size for the winter period (assuming 6,000 pre-season bandings) was $\geq$ 3,000 (Fig. 3). The resulting spatial allocation of post-season bandings was 0.12 (n=372) in Atlantic Canada, 0.04 (n=120) in Quebec, 0.03 (n=102) in Ontario, 0.51 (n=1545) in northern Atlantic Flyway, 0.23 (n=704) in the southern Atlantic Flyway, and 0.05 (n=158) in the Mississippi Flyway.  

*Field Protocols*-Pre-season banding operations adhered to standard protocols (citations). Black ducks, mallards, and hybrids were captured between July and September using a combination of swim-in bait traps, rocket nets, and spot-lighting from airboats. Each bird was fitted with a standard U.S. Fish and wildlife Service leg band and the band number, species, sex and age recorded (Carney 1992, Black Duck Joint Venture 2012). During pre-season operations birds were aged as either hatch-year (HY; BBL age codes 2, 3, 4) or after hatch-year (AHY; BBL age codes 1, 7, 8). Each bird was released at the trap site. All banding records were submitted to the Bird Banding Office in Canada and the U.S. Geological Survey Bird Banding Laboratory (BBL) using program Bandit. Initially, species were recorded as black duck (ABDU; BBL code 1330), mallard (MALL, BBL code 1320) and hybrid (MBDH; BBL code 1326). Starting in pre-season 2010 we identified hybrids as black duck dominant X mallard (ABDX; BBL code 1337), mallard-black duck hybrid intermediate (MBDX; BBL code 1325), mallard-black duck hybrid (MBDH; BBL code 1326), and mallard dominant X black duck hybrid (MALX; BBL code 1327). The purpose of this change was to increase consistency between banding operations and aerial surveys during which hybrids are difficult to identify and are typically identified as either parent species (i.e., black duck or mallard). We assumed black duck dominant hybrids (1337) and mallard dominant hybrids (1327) would be identified as black ducks or mallards, respectively, during aerial surveys. The inclusion of these new hybrid categories allows for future pooling of banding data, if appropriate, and increased consistency with aerial survey data collection. Post-season banding operations occurred between February and March 10 and followed the same protocols as pre-season operations. Species were aged and sexed using methods described by Ashley et al. 2006. Birds were aged as either second-year (SY, BBL age code 5) or after second-year (ASY, BBL age code 6). Field operations were conducted by Federal, Provincial, State Agency and one non-government organization personnel. The selection of banding sites and method of trapping was determined by personnel in the field.

```{r bandings_map}
library(maps)
library(ggplot2)
library(mapdata)
library(maptools)
usa1 <- map_data("usa")
can1 <- map_data("worldHires", "Canada")
can1$group <- can1$group + max(usa1$group)
both1 <- rbind(usa1, can1)
# Zoom in!!!!
cbPalette <- c("Blue", "Orange")
# See Figure 2 at end
# Note - these aren't all bandings, just those in the final subsetted data set
```
  
*Figure Y: Map of all pre- and post-season banding locations of birds used in survival modeling.*

## Survival and recovery modeling

We fit a joint 2-season Brownie model [@Brownie1985] to black ducks, mallards, and hybrids (ABDX, MBDX, MBDH, and MALX). 2-season Brownie models estimate hunting-season ($SH$) and non-hunting-season ($SN$) survival for all but the last year of banding, and recovery rates ($f$) for every year of banding. Annual survival can be derived as the product of hunting-season and non-hunting season survival in a given year (where a year runs August-August), or $SH*SN$. The number of birds recovered in each year, of those banded in a particular year, is a multinomial random variable, with probabilities given by a combination of survival and recovery probabilities (Table 2).  

Hunting-season survival referred to survival from August 14 to January 16, while non-hunting-season survival referred to survival from January 17 to August 13 (the approximate mid-point in each banding season). We created separate m-arrays for cohorts of adult male (e.g., $SH.am$), adult female ($SH.af$), juvenile male ($SH.jm$), and adult female ($SH.jf$).

We partitioned seasonal survival into a species-, cohort-, and season-specific mean, and a year-specific error term, e.g.:

$$
logit(SH.am_{s,i}) = \mu_{s,am}^H + \epsilon_{i}
$$

where $\mu_{s,am}^{H}$ is the mean survival for species $s$ (American black duck, mallard, or hybrid) for the hunting season for adult males, and $\epsilon_{i}$ is error term for year $i$.

One of the fundamental assumptions of two-season Brownie models is that the pre- and post-season-banded birds come from the same population. We tested this assumption informally by comparing annual survival estimates derived from models fit to two-season data ("two-season model"), pre-season data only ("pre-season model"), and post-season data only ("post-season model"). If the populations are the same, we would expect the two-season and pre-season models to give roughly the same survival estimates. The post-season model survival estimates are not directly comparable to the pre-season or two-season models' annual survival estimates. **For instance, in the calendar year (or hunting season) of 2010, the pre-season model would estimate annual survival as $S_2$, since 2010 would be the second hunting season to which pre-season banded birds would be exposed. This survival probability would be a product of $SH_2$ and $SN_2$ under the two-season model, or equivalent to $S_2$ under the two-season model. However, the post-season model would estimate $S.am_1$ for hunting season 2010, since this is the first hunting season to which post-season banded birds are exposed. This probability would be a product of $SN.am_1$ and $SH.am_2$ under the two-season model. Moreover, recovery rates estimated under the post-season model would not be comparable to those estimated under the two-season model, as they are actually a product of non-hunting-season survival and recovery rate.** Thus, we only compared the two-season and post-season models' survival estimates qualitatively, to see if they were relatively close and observe any unusual patterns, and did not compare recovery rates from the two-season and post-season models.

If the single-population assumption held, we would also expect the spatial distributions of recoveries of adult pre- and post-season banded birds in the first hunting season after banding to be similar. Adult birds, regardless of capture season, have experienced  $\geq$ 1 hunting season and, we assume, have established a seasonal migratory route. In contrast, hatch year birds captured during pre-season operations have not experienced a hunting season or migration. Therefore, the recoveries of hatch-year birds may not be comparable to the recoveries of adult birds. Dissimilar spatial distributions of pre- and post-season adult-banded bird recoveries in the first hunting season after banding would suggest the two groups of birds use substantially different migration routes or wintering grounds, and thus are possibly from different populations. We tested whether the spatial distributions of these two groups of birds was similar using a chi-squared test of homogeneity applied to each species' same-year adult recoveries, combining recoveries from all years. In particular, we counted the number of same-year recoveries in each of six waterfowl management regions: Ontario, Quebec, Atlantic Canada, the North Atlantic coast U.S. states, the South Atlantic coast U.S. states, and the Mississippi Flyway states. We tested the null hypothesis that the probability of being recovered in a given region was the same for pre- and post-season-banded birds banded and harvested in a given year. We created tables containing the number of recoveries in each region from both the pre- and post-season banded groups, and conducted the chi-squared test using chisq.test() in program R (`r version$version.string`).

(Table of expected recoveries)
$$
\begin{center}

\begin{tabular}{c | c c c c c |}
    Bandings & Rec 1 & Rec 2 & Rec 3 & Rec 4 & Rec 5 \\ \hline      
  Pre-season, $N_1$ & $N_1 f_1$ & $N_1 S_1^{S_F} S_1^{wS} f_2$ & $N_1 S_1^{S_F} S_1^{wS} S_2^{S_F} S_2^{wS} f_3$ & $N_1 S_1^{S_F} S_1^{wS} S_2^{S_F} S_2^{wS} S_3^{S_F} S_3^{wS} f_4$ & $N_1 S_1^{S_F} S_1^{wS} S_2^{S_F} S_2^{wS} S_3^{S_F} S_3^{wS} S_4^{S_F} S_4^{wS} f_5$ \\
  Post-season, $M_1$ & & $M_1  S_1^{wS} f_2$ & $M_1  S_1^{wS} S_2^{S_F} S_2^{wS} f_3$ & $M_1  S_1^{wS} S_2^{S_F} S_2^{wS} S_3^{S_F} S_3^{wS} f_4$ & $M_1  S_1^{wS} S_2^{S_F} S_2^{wS} S_3^{S_F} S_3^{wS} S_4^{S_F} S_4^{wS} f_5$ \\
  Pre-season, $N_2$ &  &  $N_2 f_2$ & $N_2  S_2^{S_F} S_2^{wS} f_3$ & $N_2  S_2^{S_F} S_2^{wS} S_3^{S_F} S_3^{wS} f_4$ & $N_2  S_2^{S_F} S_2^{wS} S_3^{S_F} S_3^{wS} S_4^{S_F} S_4^{wS} f_5$ \\
  Post-season, $M_2$ &  &  & $M_2   S_2^{wS} f_3$ & $M_2   S_2^{wS} S_3^{S_F} S_3^{wS} f_4$ & $M_2   S_2^{wS} S_3^{S_F} S_3^{wS} S_4^{S_F} S_4^{wS} f_5$ \\
  Pre-season, $N_3$ &  & & $N_3 f_3$ & $N_3   S_3^{S_F} S_3^{wS} f_4$ & $N_3   S_3^{S_F} S_3^{wS} S_4^{S_F} S_4^{wS} f_5$ \\
  Post-season, $M_3$ &  &  &  & $M_3 S_3^{wS} f_4$ & $M_3 S_3^{wS} S_4^{S_F} S_4^{wS} f_5$ \\
  Pre-season, $N_4$ &  & &  & $N_4 f_4$ & $N_4 S_4^{S_F} S_4^{wS} f_5$ \\
  Post-season, $M_4$ &  &  & & $M_4 S_4^{wS} f_5$ \\
 Pre-season, $N_5$ &  &  &  & $N_5 f_5$ \\
\end{tabular}

Table X: expected band recoveries etc.
\end{center}
$$


# Results
```{r all_spp_run, eval = pooledH}
sims.out.allspp <- runBrownieSpEffect(full.2, pooledHybrids=pooledH, JAGSMdlSpEffect)
write.csv(sims.out.allspp$resultssum, "allspp_results.csv")
sims.out.allspp$resultssum <- sims.out.allspp$resultssum[-which(rownames(sims.out.allspp$resultssum) %in% c("Tstat[1]", "Tstat[2]", "Tstat[3]")),]

```

```{r single_spp_runs, eval=F}
sims.out.abdu <- runBrownie(full.2, "ABDU", pooledHybrids=pooledH, JAGSMdl)
write.csv(sims.out.abdu$resultssum, "abdu_results.csv")
sims.out.mall <- runBrownie(full.2, "MALL", pooledHybrids=pooledH, JAGSMdl)
write.csv(sims.out.mall$resultssum, "mall_results.csv")
sims.out.hybr <- runBrownie(full.2, "HYBR", pooledHybrids=pooledH, JAGSMdl)
write.csv(sims.out.hybr$resultssum, "hybr_results.csv")
```

```{r hybrids_with_dominants, eval = notpooledH}
sims.out.abdux <- runBrownie(full.2, "ABDU", pooledHybrids=F, JAGSMdl)
sims.out.mallx <- runBrownie(full.2, "MALL", pooledHybrids=F, JAGSMdl)
```

```{r hybrids_with_dominants_results, eval = notpooledH, cache=F}
plots.abdux <- plotAndSums(sims.out.abdux$resultssum, "ABDU", plotType="surv")
dev.off()
plots.mallx <- plotAndSums(sims.out.mallx$resultssum, "MALL", plotType="surv")
dev.off()
```

## Sample sizes and spatial distributions
We captured and banded an average of 3,708 and 3,767 black  ducks during pre- and post-season banding periods (Table 3). However, some post-season banding operations were conducted prior to the end of the hunting season which varied from 25â€“31 January. We censored all post-season bandings that occurred during the hunting season resulting in an average post-season black duck sample size of 2,612 (Table 3). We achieved the post-season banding quota (after excluded birds banded prior to the end of the hunting season) of $\geq$ 3,000 black ducks in 3 of the 8 years. The spatial allocation of the pre-season banded sample, pool across years, was 0.54 in Quebec, 0.38 in Atlantic Canada, and 0.08 in Ontario (Table 1). The spatial allocation of post-season bandings, pooled across years, was 0.05 in Atlantic Canada, 0.05 in the Mississippi Flyway, 0.72 in the north Atlantic Flyway, 0.02 in Ontario, and 0.16 in the south Atlantic Flyway (Table 1). Winter banding was not conducted in Quebec. We banded an average of 19,141 and 5,837 mallards, and 182 and 317 hybrids during pre- and post-season banding seasons, respectively. 

## Survival rates

```{r survival_table, eval = pooledH}
abdu.annS.means <- round(sims.out.allspp$resultssum$Mean[seq(193, 288, by=3)], dig=2)
abdu.annS.sds <- round(sims.out.allspp$resultssum$SD[seq(193, 288, by=3)], dig=2)
abdu.annS.low <- round(sims.out.allspp$resultssum$Lower95[seq(193, 288, by=3)], dig=2)
abdu.annS.high <- round(sims.out.allspp$resultssum$Upper95[seq(193, 288, by=3)], dig=2)

mall.annS.means <- round(sims.out.allspp$resultssum$Mean[seq(195, 288, by=3)], dig=2)
mall.annS.sds <- round(sims.out.allspp$resultssum$SD[seq(195, 288, by=3)], dig=2)
mall.annS.low <- round(sims.out.allspp$resultssum$Lower95[seq(195, 288, by=3)], dig=2)
mall.annS.high <- round(sims.out.allspp$resultssum$Upper95[seq(195, 288, by=3)], dig=2)

hybr.annS.means <- round(sims.out.allspp$resultssum$Mean[seq(194, 288, by=3)], dig=2)
hybr.annS.sds <- round(sims.out.allspp$resultssum$SD[seq(194, 288, by=3)], dig=2)
hybr.annS.low <- round(sims.out.allspp$resultssum$Lower95[seq(194, 288, by=3)], dig=2)
hybr.annS.high <- round(sims.out.allspp$resultssum$Upper95[seq(194, 288, by=3)], dig=2)
```

Mean annual survival ranged from `r min(abdu.annS.means[1:8])*100`\% to `r max(abdu.annS.means[1:8])*100`\% for adult male black ducks, `r min(abdu.annS.means[9:16])*100`\% to `r max(abdu.annS.means[9:16])*100`\% for adult females, `r min(abdu.annS.means[17:24])*100`\% to `r max(abdu.annS.means[17:24])*100`\% for juvenile males, and `r min(abdu.annS.means[25:32])*100`\% to `r max(abdu.annS.means[25:32])*100`\% for juvenile females, over the course of the study period (Fig. 4). Median non-hunting-season survival was often lower than hunting-season survival, though this was generally less true of juveniles than adults. Black duck survival was especially low in 2010, and in particular, the winter and summer post-season (January-August 2011), with median survival probabilities near or at their minimum.

Mean annual survival ranged from `r min(mall.annS.means[1:8])*100`\% to `r max(mall.annS.means[1:8])*100`\% for adult male mallards, `r min(mall.annS.means[9:16])*100`\% to `r max(mall.annS.means[9:16])*100`\% for adult females, `r min(mall.annS.means[17:24])*100`\% to `r max(mall.annS.means[17:24])*100`\% for juvenile males, and `r min(mall.annS.means[25:32])*100`\% to `r max(mall.annS.means[25:32])*100`\% for juvenile females, over the course of the study period (Fig. 5). Mallards had more variable seasonal survival patterns than black ducks, particularly between age classes. Median non-hunting-season survival was lower than hunting-season survival for relatively few mallard cohort-year combinations. For the most part, hunting-season survival was higher than or similar to non-hunting-season survival for adult females and lower for adult males, while non-hunting-season survival was often higher than hunting-season survival for juvenile mallards (Fig. 5). Adult female mallards seemed to have particularly low non-hunting-season survival.

Mean annual survival ranged from `r min(hybr.annS.means[1:8])*100`\% to `r max(hybr.annS.means[1:8])*100`\% for adult male hybrids, `r min(hybr.annS.means[9:16])*100`\% to `r max(hybr.annS.means[9:16])*100`\% for adult females, `r min(hybr.annS.means[17:24])*100`\% to `r max(hybr.annS.means[17:24])*100`\% for juvenile males, and `r min(hybr.annS.means[25:32])*100`\% to `r max(hybr.annS.means[25:32])*100`\% for juvenile males, over the course of the study period (Fig. 6). There were very few recoveries of hybrids, leading to large standard errors around survival estimates. However, it would appear that adult male hybrid survival was higher towards the middle of the two-season banding period than in the beginning or the end. We found that, if we pooled all black-duck-dominant hybrids with black ducks, and all other hybrids with mallards, the black duck and mallard survival estimates did not change substantially.

```{r annS_summaries_tables}
# Break this out by species and cohort instead!
abdu.results.tab <- data.frame(cbind(rep("ABDU", 32), c(rep("AM", 8), rep("AF", 8), rep("JM",8 ), rep("JF",8)), rep(2009:2016, 4),
                          abdu.annS.means, abdu.annS.sds, abdu.annS.low, abdu.annS.high))
names(abdu.results.tab) <- c("Species", "Cohort", "Year", "Mean", "SD", "Lower CI Bound", "Upper CI Bound")

mall.results.tab <- data.frame(cbind(rep("MALL", 32), c(rep("AM", 8), rep("AF", 8), rep("JM",8 ), rep("JF",8)), rep(2009:2016, 4),
                          mall.annS.means, mall.annS.sds, mall.annS.low, mall.annS.high))
names(mall.results.tab) <- c("Species", "Cohort", "Year", "Mean", "SD", "Lower CI Bound", "Upper CI Bound")

hybr.results.tab <- data.frame(cbind(rep("HYBR", 32), c(rep("AM", 8), rep("AF", 8), rep("JM",8 ), rep("JF",8)), rep(2009:2016, 4),
                          hybr.annS.means, hybr.annS.sds, hybr.annS.low, hybr.annS.high))
names(hybr.results.tab) <- c("Species", "Cohort", "Year", "Mean", "SD", "Lower CI Bound", "Upper CI Bound")
```

```{r print_abdu_tab, results = "asis", eval = F}
knitr::kable(abdu.results.tab)
```

```{r print_mall_tab, results = "asis", eval=F}
knitr::kable(mall.results.tab)
```

```{r print_hybr_tab, results = "asis", eval = F}
knitr::kable(hybr.results.tab)
```
  
## Recovery rates
Recovery rates of black ducks showed little temporal variability, suggesting that harvest rates and reporting rates, or their combination, were fairly constant over time. Recovery rates were generally low; most were under 0.2 (Fig. 7). Similar to those for black ducks, recovery rates of mallards showed little temporal variability (Fig. 7). However, juvenile recovery rates were often around twice as high as those of adults (Fig. 7).

## Evaluation of model assumptions
### Bayesian p-value analysis - NEW
```{r bayesian_p, eval=pooledH}
Tstat.abdu <- sims.out.allspp$jagsobj$mcmc[,"Tstat[1]"]
bpv.abdu <- mean(unlist(Tstat.abdu)>0)
Tstat.hybr <- sims.out.allspp$jagsobj$mcmc[,"Tstat[2]"]
bpv.hybr <- mean(unlist(Tstat.hybr)>0)
Tstat.mall <- sims.out.allspp$jagsobj$mcmc[,"Tstat[3]"]
bpv.mall <- mean(unlist(Tstat.mall)>0)
```

The Bayesian p-value of our black duck model was `r round(bpv.abdu, dig=3)`, suggesting evidence of overdispersion. (explanation?) However, the Bayesian p-value of our mallard model was `r round(bpv.mall, dig=3)`. For hybrids was `r round(bpv.hybr, dig=3)`

```{r single_season_pre, eval = pooledH}
# To assess single-population assumption
sims.out.preSS <- runSingleSeasonBrownieSpEffect(full.2, pooledHybrids=pooledH, JAGSMdlPreSpEffect, season="Pre")
```

```{r single_season_post, eval=pooledH}
sims.out.postSS <- runSingleSeasonBrownieSpEffect(full.2, pooledHybrids=pooledH, JAGSMdlPostSpEffect, season="Post")
```

```{r write_single_csvs, eval=pooledH}
write.csv(sims.out.preSS$resultssum, "pre_results.csv")
write.csv(sims.out.postSS$resultssum, "post_results.csv")
```

```{r brownie_model_fit_abdu}
# Compare annual survival estimates from pre and full models
# Unfactorize stuff - why is it only a problem NOW huh?
# Factors are the WORST
abdu.medianS <- data.frame(varnames=row.names(sims.out.allspp$resultssum)[seq(193, 288, by=3)],twos=sims.out.allspp$resultssum$Median[seq(193, 288, by=3)],onespre=sims.out.preSS$resultssum$Median[seq(1, 96, by=3)])
abdu.meanS <- data.frame(varnames=row.names(sims.out.allspp$resultssum)[seq(193, 288, by=3)],twos=sims.out.allspp$resultssum$Mean[seq(193, 288, by=3)],onespre=sims.out.preSS$resultssum$Mean[seq(1, 96, by=3)])
row.names(sims.out.allspp$resultssum[seq(193, 288, by=3),])[which(abs(abdu.medianS$twos-abdu.medianS$onespre)>0.05)]
abdu.medianS$onespost <- c(NA, sims.out.postSS$resultssum$Median[seq(1, 21, by=3)],
                           NA,             sims.out.postSS$resultssum$Median[seq(22, 42, by=3)],
                           NA,
sims.out.postSS$resultssum$Median[seq(43, 63, by=3)],
NA,
sims.out.postSS$resultssum$Median[seq(64, 84, by=3)])

# Compare annual survival estimates from post and full models

# Mean survival estimates by cohort, species, season
abdu.means.preSS <- sims.out.preSS$resultssum$Mean[seq(1, 96, by=3)]
abdu.means.postSS <- sims.out.postSS$resultssum$Mean[seq(1, 84, by=3)]

mean(abdu.means.preSS[1:8]); mean(abdu.means.preSS[9:16]); mean(abdu.means.preSS[17:24]); mean(abdu.means.preSS[25:32])

mean(abdu.means.postSS[1:7]); mean(abdu.means.postSS[8:14]); mean(abdu.means.postSS[15:21]); mean(abdu.means.postSS[22:28])

hybr.means.preSS <- sims.out.preSS$resultssum$Mean[seq(2, 96, by=3)]
hybr.means.postSS <- sims.out.postSS$resultssum$Mean[seq(2, 84, by=3)]

mean(hybr.means.preSS[1:8]); mean(hybr.means.preSS[9:16]); mean(hybr.means.preSS[17:24]); mean(hybr.means.preSS[25:32])

mean(hybr.means.postSS[1:7]); mean(hybr.means.postSS[8:14]); mean(hybr.means.postSS[15:21]); mean(hybr.means.postSS[22:28])

mall.means.preSS <- sims.out.preSS$resultssum$Mean[seq(3, 96, by=3)]
mall.means.postSS <- sims.out.postSS$resultssum$Mean[seq(3, 84, by=3)]

mean(mall.means.preSS[1:8]); mean(mall.means.preSS[9:16]); mean(mall.means.preSS[17:24]); mean(mall.means.preSS[25:32])

mean(mall.means.postSS[1:7]); mean(mall.means.postSS[8:14]); mean(mall.means.postSS[15:21]); mean(mall.means.postSS[22:28])
```

```{r brownie_model_fit_mall}
mall.medianS <- data.frame(varnames=row.names(sims.out.allspp$resultssum)[seq(195, 288, by=3)],twos=sims.out.allspp$resultssum$Median[seq(195, 288, by=3)],onespre=sims.out.preSS$resultssum$Median[seq(3, 96, by=3)])
mall.meanS <- data.frame(varnames=row.names(sims.out.allspp$resultssum)[seq(195, 288, by=3)],twos=sims.out.allspp$resultssum$Mean[seq(195, 288, by=3)],onespre=sims.out.preSS$resultssum$Mean[seq(3, 96, by=3)])
row.names(sims.out.allspp$resultssum[seq(195, 288, by=3),])[which(abs(mall.medianS$twos-mall.medianS$onespre)>0.05)]
mall.medianS$onespost <- c(NA, sims.out.postSS$resultssum$Median[seq(3, 21, by=3)],
                           NA,             sims.out.postSS$resultssum$Median[seq(24, 42, by=3)],
                           NA,
sims.out.postSS$resultssum$Median[seq(45, 63, by=3)],
NA,
sims.out.postSS$resultssum$Median[seq(66, 84, by=3)])
```

Single-season models fit only to pre-season data gave similar estimates to those fit to two-season data for both black ducks and mallards (Fig. x). In particular, the average percent difference between median annual black duck survival rates estimated using all data and only pre-season data was only `r round(mean((100*abs(abdu.medianS$twos-abdu.medianS$onespre))/abdu.medianS$twos),dig=2)`\%, while the average difference for mallards was `r round(mean((100*abs(mall.medianS$twos-mall.medianS$onespre))/mall.medianS$twos),dig=2)`\%. On the other hand, median annual survival estimates from post-season data diverged more from annual survival estimates from two-season data, for both black ducks (`r round(mean((100*abs(abdu.medianS$twos-abdu.medianS$onespost))/abdu.medianS$twos, na.rm=T),dig=2)`\% difference) and mallards (`r round(mean((100*abs(mall.medianS$twos-mall.medianS$onespost))/mall.medianS$twos,na.rm=T),dig=2)`\% difference). Median annual survival estimates of post-banded birds from the first hunting season (autumn 2010) were especially high for both species and all cohorts, relative to annual survival estimates for the same hunting season estimated using two-season or pre-season data (Figs. 8 and 9).

```{r abdu_variance_reduction, eval = pooledH}
abdu_var_reduct <- 100*round(((sims.out.allspp$resultssum$SD[seq(193, 288, by=3)]^2)-sims.out.preSS$resultssum$SD[seq(1, 96, by=3)]^2)/(sims.out.preSS$resultssum$SD[seq(1, 96, by=3)]^2),dig=2) # Aw this is fantastic!
```

```{r mall_variance_reduction, eval = pooledH}
mall_var_reduct <- 100*round(((sims.out.allspp$resultssum$SD[seq(195, 288, by=3)]^2)-sims.out.preSS$resultssum$SD[seq(3, 96, by=3)]^2)/(sims.out.preSS$resultssum$SD[seq(3, 96, by=3)]^2),dig=2) # Aw this is fantastic!
```

```{r cv_abdu, eval=pooledH}
abdu_cv <- round(100*sims.out.allspp$resultssum$SD[seq(193, 288, by=3)]/sims.out.allspp$resultssum$Mean[seq(193, 288, by=3)],dig=2)
#abdu_cv_am <- abdu_cv[1:8]
#abdu_cv_af <- abdu_cv[9:16]
#abdu_cv_jm <- abdu_cv[17:24]
#abdu_cv_jf <- abdu_cv[25:32]
```

The coefficient of variation of annual survival for black ducks (estimated using the 2-season model) ranged from `r min(abdu_cv[1:8])` to `r max(abdu_cv[1:8])` for adult males, `r min(abdu_cv[9:16])` to `r max(abdu_cv[9:16])` for adult females, `r min(abdu_cv[7:24])` to `r max(abdu_cv[17:24])` for juvenile males, and `r min(abdu_cv[25:32])` to `r max(abdu_cv[25:32])` for juvenile females. Estimating annual survival using the 2-season Brownie model reduced variance estimates of annual survival relative to the pre-season-only model in almost all cases, for both black ducks and mallards. Variance of annual survival estimates for black ducks was reduced an average of `r -mean(abdu_var_reduct)`\% when using the 2-season Brownie model; `r sum(abdu_var_reduct < 0)` variance estimates decreased when using a 2-season Brownie model (out of 32; 8 annual survival estimates each for 4 cohorts). Similarly, variance of annual survival estimates for mallards was reduced an average of `r -mean(mall_var_reduct)`\% when using the 2-season Brownie model.

```{r chisq_by_state2}
library(sp)
library(raster)

# By Eregion
full.2$Eregion <- ""
full.2$num_e_area <- as.numeric(as.character(full.2$E_AREA_CODE))
full.2$num_b_area <- as.numeric(as.character(full.2$Bregion))
ontcodes <- regions$Eregion[which(regions$Earea=="ONT")] 
quecodes <- regions$Eregion[which(regions$Earea=="QUE")] 
marcodes <- regions$Eregion[which(regions$Earea=="MAR")] 
natlcodes <- regions$Eregion[which(regions$Earea=="NATL")] 
satlcodes <- regions$Eregion[which(regions$Earea=="SATL")] 
misscodes <- regions$Eregion[which(regions$Earea=="MISS")] 

full.2$Eregion[which(full.2$num_e_area %in% ontcodes)] <- "ONT"
full.2$Eregion[which(full.2$num_e_area %in% quecodes)] <- "QUE"
full.2$Eregion[which(full.2$num_e_area %in% marcodes)] <- "MAR"
full.2$Eregion[which(full.2$num_e_area %in% natlcodes)] <- "NATL"
full.2$Eregion[which(full.2$num_e_area %in% satlcodes)] <- "SATL"
full.2$Eregion[which(full.2$num_e_area %in% misscodes)] <- "MISS"
full.2$Eregion[which(full.2$Eregion=="")] <- "Other" # Excluding these I guess - see line below
full.2$Eregion <- factor(full.2$Eregion, levels = c("ONT", "QUE", "MAR", "NATL", "SATL", "MISS"))

# For data analysis purposes - do these regions by banding area as well?
full.2$Bregion2 <- ""
full.2$Bregion2[which(full.2$num_b_area %in% ontcodes)] <- "ONT"
full.2$Bregion2[which(full.2$num_b_area %in% quecodes)] <- "QUE"
full.2$Bregion2[which(full.2$num_b_area %in% marcodes)] <- "MAR"
full.2$Bregion2[which(full.2$num_b_area %in% natlcodes)] <- "NATL"
full.2$Bregion2[which(full.2$num_b_area %in% satlcodes)] <- "SATL"
full.2$Bregion2[which(full.2$num_b_area %in% misscodes)] <- "MISS"
full.2$Bregion2[which(full.2$Bregion2=="")] <- "Other" # Excluding these I guess - see line below
full.2$Bregion2 <- factor(full.2$Bregion2, levels = c("ONT", "QUE", "MAR", "NATL", "SATL", "MISS"))
# ^ Might need more of these for mallards??

allbirds <- full.2[which(full.2$BYEAR==full.2$Hyear & full.2$BSeason %in% c("Pre", "Post")) ,] # see what happens without full.2$Hyear>2009

# Black ducks first!!
allbirds.abdu <- full.2[which(full.2$BYEAR==full.2$Hyear & full.2$Spp=="ABDU" & full.2$BSeason %in% c("Pre", "Post")) ,]
#allbirds <- allbirds[-which(allbirds$E_LON_FLOAT==0),]
postallbirds.abdu <- allbirds.abdu[which(allbirds.abdu$BSeason=="Post"),]
preallbirds.abdu <- allbirds.abdu[which(allbirds.abdu$BSeason=="Pre"&
                              allbirds.abdu$cohort %in% c("AM", "AF")),]
chisq.tab.all.abdu <- rbind(table(preallbirds.abdu$Eregion), table(postallbirds.abdu$Eregion))
dimnames(chisq.tab.all.abdu)[[1]] <- c("Pre", "Post")
#chisq.tab.all.abdu/rowSums(chisq.tab.all.abdu)
goftest.abdu <- chisq.test(chisq.tab.all.abdu)

# Mallards
allbirds.mall <- full.2[which(full.2$BYEAR==full.2$Hyear & full.2$Spp=="MALL" & full.2$BSeason %in% c("Pre", "Post") & full.2$Hyear>2009) ,]
#allbirds <- allbirds[-which(allbirds$E_LON_FLOAT==0),]
postallbirds.mall <- allbirds.mall[which(allbirds.mall$BSeason=="Post"),]
preallbirds.mall <- allbirds.mall[which(allbirds.mall$BSeason=="Pre"&
                              allbirds.mall$cohort %in% c("AM", "AF")),]
chisq.tab.all.mall <- rbind(table(preallbirds.mall$Eregion), table(postallbirds.mall$Eregion))
dimnames(chisq.tab.all.mall)[[1]] <- c("Pre", "Post")
#chisq.tab.all.mall/rowSums(chisq.tab.all.mall)
goftest.mall <- chisq.test(chisq.tab.all.mall)

# Hybrids
allbirds.hybr <- full.2[which(full.2$BYEAR==full.2$Hyear & full.2$Spp %in% c("MBDH", "MBDX", "ABDX", "MALX") & full.2$BSeason %in% c("Pre", "Post") & full.2$Hyear>2009) ,]
#allbirds <- allbirds[-which(allbirds$E_LON_FLOAT==0),]
postallbirds.hybr <- allbirds.hybr[which(allbirds.hybr$BSeason=="Post"),]
preallbirds.hybr <- allbirds.hybr[which(allbirds.hybr$BSeason=="Pre"&
                              allbirds.hybr$cohort %in% c("AM", "AF")),]
chisq.tab.all.hybr <- rbind(table(preallbirds.hybr$Eregion), table(postallbirds.hybr$Eregion))
dimnames(chisq.tab.all.hybr)[[1]] <- c("Pre", "Post")
#chisq.tab.all.hybr/rowSums(chisq.tab.all.hybr)
goftest.hybr <- chisq.test(chisq.tab.all.hybr)

```

```{r recovs_multiyear_extra,eval=F}
#### For sure consider using this later!!!
library(maps)
library(ggplot2)
library(mapdata)
library(maptools)
usa1 <- map_data("usa")
can1 <- map_data("worldHires", "Canada")
can1$group <- can1$group + max(usa1$group)
both1 <- rbind(usa1, can1)
# Zoom in!!!!
#ggplot() + geom_polygon(data = both1, aes(x=long, y = lat, group = group), fill = NA, col = "black") + coord_fixed(1.3)  + geom_point(data = allbirds, aes(x=E_LON_FLOAT, y=E_LAT_FLOAT, color=Eregion, shape = BSeason)) + facet_wrap(~Hyear) + coord_cartesian(ylim=c(30, 60),xlim=c(-100, -50)) + theme_bw()
#cbPalette <- c("Blue","Orange")
allbirds.abdu$BSeason_labs <- ifelse(allbirds.abdu$BSeason=="Pre", "black duck pre-season bandings", "black duck post-season bandings")
ggplot() + geom_polygon(data = both1, aes(x=long, y = lat, group = group), fill = NA, col = "black") + coord_fixed(1.3)  + geom_point(data = allbirds.abdu, aes(x=E_LON_FLOAT, y=E_LAT_FLOAT, color=BSeason_labs)) + facet_wrap(~Hyear) + coord_cartesian(ylim=c(30, 60),xlim=c(-100, -50)) + theme_bw() + scale_color_manual(name = "Banding season", values=c("blue","orange"))
#ggplot() + geom_polygon(data = both1, aes(x=long, y = lat, group = group), fill = NA, col = "black") + coord_fixed(1.3)  + geom_point(data = allbirds, aes(x=E_LON_FLOAT, y=E_LAT_FLOAT, color=Bregion2, shape = BSeason)) + facet_wrap(~Hyear) + coord_cartesian(ylim=c(30, 60),xlim=c(-100, -50)) + theme_bw()



# By year now, black ducks
#for(j in 2010:2017){
# yrbirds <- full.2[which(full.2$BYEAR==j & full.2$Hyear==j & full.2$Spp=="MALL"),]
# 
# postyrbirds <- yrbirds[which(yrbirds$BSeason=="Post"),]
# preyrbirds <- yrbirds[which(yrbirds$BSeason=="Pre"&
#                               yrbirds$cohort %in% c("AM", "AF")),]
# chisq.tab.yr <- rbind(table(preyrbirds$Eregion), table(postyrbirds$Eregion))
# print(chisq.tab.yr)
# print(chisq.test(chisq.tab.yr))
# }
```

```{r glm_gof, eval = F}
gof.allyrs.pre.tab <- table(preallbirds$Eregion, preallbirds$Hyear)
gof.allyrs.post.tab <- table(postallbirds$Eregion, postallbirds$Hyear)
pre.gof.dat <- c(gof.allyrs.pre.tab)
post.gof.dat <- c(gof.allyrs.post.tab)
gof.dat <- c(pre.gof.dat, post.gof.dat)
gof.vars <- expand.grid(region=dimnames(gof.allyrs.pre.tab)[[1]], year=dimnames(gof.allyrs.pre.tab)[[2]], season=c("Pre", "Post"))
gof.dat.full <- cbind(gof.vars, gof.dat)
names(gof.dat.full) <- c("Region", "Year", "Season", "Count")

# Poisson glm
gof.glm <- glm(Count ~ Region+factor(Year)+Season, data=gof.dat.full, family="poisson")
summary(gof.glm)
```
Same-year band recoveries from pre- and post-season banded birds overlapped spatially, suggesting that birds from these samples were migrating to or from, or wintering in, similar areas. However, $\chi^2$ tests of homogeneity indicated that the probabilities of going to a given region were not equal for pre- and post-season adult-banded birds, regardless of species (black ducks: $\chi^2$ = `r round(goftest.abdu$statistic,dig=2)`, $df$ = `r goftest.abdu$parameter`, $p$ = `r round(goftest.abdu$p.value, dig=2)`; mallards: $\chi^2$ = `r round(goftest.mall$statistic,dig=2)`, $df$ = `r goftest.mall$parameter`, $p$ = `r round(goftest.mall$p.value, dig=2)`; hybrids: $\chi^2$ = `r round(goftest.hybr$statistic,dig=2)`, $df$ = `r goftest.hybr$parameter`, $p$ = `r round(goftest.hybr$p.value, dig=2)`). However, most of the difference in the spatial distribution of pre- and post-season adult band recoveries seemed to be in the North Atlantic region (Tables 4-6).

```{r print_chisq_abdu, results = "asis"}
knitr::kable(chisq.tab.all.abdu)
```
  
*Table X: Recovery regions of pre- and post-season adult-banded black ducks recovered in the same year as banding.*
```{r print_chisq_mall, results = "asis"}
knitr::kable(chisq.tab.all.mall)
```
  
*Table Y: Recovery regions of pre- and post-season adult-banded mallardss recovered in the same year as banding.*
```{r print_chisq_hybr, results = "asis"}
knitr::kable(chisq.tab.all.hybr)
```
  
*Table Z: Recovery regions of pre- and post-season adult-banded hybrids recovered in the same year as banding.*

# Discussion
**Order: annual survival (by and between species); seasonal survival (by and between species); recovery rates (by and in between species); model assumptions**
[ANNUAL SURVIVAL] Estimates of annual survival and patterns among age and sex cohorts using pre-season and two-season models were similar to previously published results for black ducks and mallards. Annual survival of adult and juvenile ranged from 0.32â€”0.744 and 0.360â€”0.702 for black ducks and mallards, respectively (Nichols et al. 1982). Mean annual survival of black ducks banded pre-season was 0.63 for adult males, 0.47 for adult females, 0.48 for juvenile males and 0.38 for juvenile females [@Krementz1987]. Annual survival was 0.71 for adult males and 0.58 for adult females banded during post season [i.e., January to February; @Krementz1987]. Mean annual survival for adult black ducks was 0.63 and 0.70 based on pre-season only and post-season only models, 0.56 and 0.611 for adult female black ducks based on pre-season and post-season only models, and 0.43 for juvenile males and juvenile females based on pre-season model only (Blandin 1982). Our results support the conclusion that adult males (of black ducks and mallards) have higher survival than other cohorts, adult females and juvenile males have similar survival rates, and juvenile females have the lowest survival rates. Our results corroborate previous research indicating similar cohort-specific annual survival rates between black ducks and mallards (citations). Our results indicate similar annual survival rates among black ducks, mallards, and their hybrids.    

[SEASONAL SURVIVAL] We found that patterns in seasonal survival of American black ducks varied by age, and to a lesser extent by sex. Survival rates during the hunting and non-hunting season did not differ significantly for either adult males or adult females in most years (Fig. 4). For adult male black ducks, point estimates of hunting season survival were higher than non-hunting season survival in 4 of 8 years, and less than or equal in the other 4 years. For adult female black ducks, the point estimate for hunting season survival was greater than non-hunting season survival in 6 of the 8 years and lower in 2 of the 8 years. In contrast, juvenile survival for both sexes was much lower during the hunting season than in the non-hunting season were significantly different in in 6 of 8 and 4 of 8 years for juvenile males and females, respectively. The difference in adult and juvenile seasonal survival is probably due to differential vulnerability to harvest [@Roy2015; citations]. Juvenile black ducks are 1.9 and 1.8 times more vulnerable to harvest than adult males where has adult females are 0.9 times as vulnerable to harvest compared to adult males (U.S. Fish and Wildlife Service, Division of Migratory Bird Management unpublished data). [Review black duck hunting literature and exposure of juveniles to adults; Francies et al has estimates of survival based on post season bandings)] 
Female black ducks exhibited greater annual and inter-annual variability in non-hunting season survival than male black ducks.  In particular, non-hunting season survival for adult and juvenile females were near or at their minimum in 2014 which coincided with an extremely cold winter that consisted of long periods of sub-freezing conditions and extensive ice coverage of freshwater and tidal wetlands along the Atlantic coast. Adult males were found to have higher survival but similar recovery rates than adult females with the difference attributed to higher mortality risk of females during the breeding season [@Krementz1987]. [Review literature on black duck winter survival, extended freezing conditions and large scale die offs].
Mallards and hybrids exhibited similar patterns in annual and seasonal survival rates by age and sex cohort as black ducks. Juvenile survival during the hunting season was much lower for both male and female mallards relative to black ducks. We posit this is due to more liberal harvest regulations for mallards relative to black ducks during the course of the projectstudy period. Black ducks and mallards were exposed to the same season lengths (60 days in the United States) but the daily bag limit was greater for mallards (4 males and 2 females) compared to 1â€”2 black ducks of either sex. Female mallards and hybrids also exhibited low non-hunting and annual survival in 2014 coinciding with extreme winter weather across much of eastern North America. Hybrids exhibited similar patterns in annual and seasonal survival rates as black ducks and mallards. Our results of more variable non-hunting season survival among females relative to males is consistent with the hypothesis that females suffer higher mortality than males during the breeding season [@Krementz1987]. 
[RECOVERY RATES] Recovery rates of black ducks and mallards displayed similar inter-annual variation, but were generally lower for black ducks than mallards. Recovery rates of adult hybrids were similar to adult black ducks and mallards, but recovery rates of juvenile hybrids appear to be slightly higher and more variable compared to juvenile black ducks and mallards. Our results are similar to those of @Nichols1987, that found mallards had similar, but slightly higher recovery rates ($\bar{x}$ = 0.097; range 0.036â€”0.142) than sympatric black ducks mallards ($\bar{x}$ = 0.095; range 0.043â€”0.160) across reference areas and years (1959â€”1984). Estimates of cohort specific recovery rates were similar to those report for black ducks between 1952â€”1983 [@Krementz1987] and indicated juveniles have higher recovery rates than adults (Blandin 1982). It is generally accept in the waterfowl management community that juveniles have higher recovery rates than adult because they are naÃ¯ve to hunting pressure and more vulnerable to harvest [Anderson 1975; Boyd and Hyslop 1985; @Krementz1987; @Roy2015, citations]. Our results are consistent with these findings. 
[MODEL FIT  and ASSUMPTIONS and Comparison among models] There was generally high agreement between annual survival estimates from models using two-season data and those using pre-season data only for all age and sex cohorts and species (Fig. 8 and 9). Estimates of annual survival based on the post-season model were consistently higher for adult females and juveniles of both sexes compared to the pre-season only and two-season models (Fig. 8 and 9). This may be an artefact of how seasons are grouped differently in annual survival models using pre-season and post-season data (see above). Thus, $S_{a,s,1}^a$ under the pre-season model and under the post-season model are not directly comparable (though, falling in the same hunting season, they should be qualitatively similar). Also, $S_{a,s,1}^a$ in the post-season model would not include the non-hunting season of 2010 (January-August 2011), which was characterized by low survival in many cohorts of both species. This might explain its large over-estimate of annual survival in that year. The exception to this patterns was adult males of both species which exhibited greater correlation among annual survival estimates among data types (Fig. 8 and 9). This may be due to the larger sample size of adult males in pre- and post-hunting banded samples compared to the other cohorts. Estimates of annual survival rates for black ducks based on post-season only model was higher, though not significantly, than pre-season only model [@Krementz1987].  
Nichols et al. (1982) also compared estimates of annual survival between black ducks and mallards using pre-season only, post-season only and two-season models. Similar to our results they found that pre-season only and two-season models produced similar estimates for both species and that mallards had slightly higher, but not significantly, annual survival. In contrast, estimates of annual survival based on post-season only models were much higher for both species, and indicated black ducks had significantly higher survival than mallards. Continental averages of annual survival of mallards based on post-season survival were slightly, though not significantly higher, than estimates derived from the pre-season model [@Nichols1987]. Estimates of annual survival of adult male and female black ducks based on post-season only model were higher than pre-season only models [@Krementz1987]. In contrast, Blandin (1982) failed to detect differences in annual survival between pre- and post-season models for adults banded in the same or related geographic areas, except in two locations in which indicated much higher survival based on the post-season model
As detailed by @Nichols1987, â€œestimates of annual survival of adults should be similar between pre-season and post-season only models if: (1) the same population(s) is represented by the 2 banded samples; and (2) the survival estimates are reasonable accurateâ€.  Nichols et al. (1987) acknowledge the potential that the pre- and post-seasons samples were not derived from the same populations owing to limited geographic coverage of the pre-season sample and unavailability of northern breeding birds, but concluded their results were consistent with the hypothesis of heterogeneous survival and recovery rates which predicts greater bias in post-season models (Nichols et al. 1982, Pollock and Raveling 1982).   
In the current study, we explicitly addressed the assumption that the same population(s) is represented in each season by accounting for the transition of black ducks banded during pre-season to specific to wintering regions. The similar spatial distribution of pre-and post-season recoveries of adult birds suggest we met this assumption. In contrast, the distribution of post-season banding quotas or locations were not designed to meet this assumption for mallards and hybrids, yet our results showed the same pattern as @Nichols1987. Thus, our results further support the hypothesis of heterogeneous survival and recovery rates (Nichols et al. 1982, Pollock and Raveling 1982 ).  

Despite the similarities to @Nichols1987, we cannot conclude, definitively, that our design did not violate the assumption of banding the same black duck population in both seasons.  Breeding black ducks have a much larger spatial distribution across eastern Canada than mallards (citations), particular in remote areas of the boreal forest where pre-season banding is non-existent. Thus it is possible that we violated this assumption for black ducks but not for mallards and hybrids which have a much more limited distribution in the southern parts of Ontario, Quebec, and New Brunswick and Nova Scotia (citations).  On-going research on the natal origins of black ducks harvested in Canada and the United States using stable isotope markers should provide greater insight into this hypothesis. [Review literature on single versus multi-season banding and estimates of vital rates]

# Conclusions

The two-season banding program and associated seasonal survival model [$H_7$; @Brownie1985] provide greater insight into the survival process of black ducks and mallards and increased precision in the estimation of annual survival relative to the standard single, pre-season banding program.  The estimates of non-hunting seasonal survival suggest that black duck and mallard populations are not regulated by post-hunting season density dependent survival, though in some years extreme winter weather (i.e., extended periods of daily maximum temperature <32 $^{\circ}$ Fahrenheit and extensive freezing of freshwater and tidal wetlands [citation â€“ either NJ work]) can cause decrease in seasonal and annual survival. 
In contrast, survival during the hunting season may have a more pronounced effect on annual survival and population growth, particularly relative to the juvenile portion of the population. The two-season banding program may provide even greater insight into the survival process and population regulation when the time series spans changes in harvest regulations. The mallard harvest regulations in the Atlantic Flyway States are set to change from a 60-day season and 4 bird daily bag limit (2 hen restrictions) to a 60-day season and 2 bird daily bag limit (1 hen restriction) during the 2019 hunting season. If harvest mortality is additive to natural mortality, we predict mallard hunting season survival will increase following the implementation of the new regulations. Further, if non-hunting season survival is governed by density dependence we would expect to see lower non-hunting season survival following the implementation of the restrictive regulations. Alternatively, if mallard harvest mortality is compensatory we do not expect to observe changes in either hunting- or non-hunting seasonal survival rates following the implementation of restrictive regulations.  
The current state-space model the forms the basis of the International Black Duck Harvest Strategy partitions annual survival into two seasons; hunting (Octoberâ€”January) and non-hunting (Februaryâ€”September). This formulation, though sufficient for harvest management, limits the ability of researchers to investigate alternative hypotheses of population regulation. The two-season banding program provides greater information that can be used to develop more mechanistic models and test competing hypotheses of population regulation over time (citation - Nichols paper that is being published â€“ role of long-term monitoring in learning). Further, the increased precision gained via the two-season program can improved harvest management by providing greater information for evaluating the relationship between harvest mortality and survival.



# Author contributions
P.K.D. conceived of the idea, coordinated the project, contributed to data analysis and led analyzed data and let the writing of the manuscript. G.S.B. and G.Z. designed the simulation and sampling process and developed code for analyses. R.L.E. assembled data, revised analytical code, and led the writing of the manuscript. J.A.R. provided statistical advice for the analysis of the data. All authors contributed critically to the drafts and gave final approval for publication. 

# Tables and figures
```{r fig2_bandings_map}
ggplot() + geom_polygon(data = both1, aes(x=long, y = lat, group = group), fill = NA, col = "black") + coord_fixed(1.3)  + geom_point(data = subset(full.2, BSeason != "Other"), aes(x=LON_FLOAT, y=LAT_FLOAT, color=BSeason)) + coord_cartesian(ylim=c(30, 60),xlim=c(-100, -50)) + theme_bw() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black"), text = element_text(size=15)) +
  scale_color_manual(values=cbPalette)
```
*Figure 2. Distribution of pre- (orange) and post-season (blue) banding locations participating in the pilot two-season banding program to estimate annual and seasonal survival rates of American black ducks, mallards, and hybrids, 2009â€“2017(?).*

```{r abdu_results, eval = pooledH, cache = F}
plots.abdu <- plotAndSumsSpEffect(sims.out.allspp$resultssum, "ABDU", plotType = "surv")
dev.off()
```
*Figure 4. Estimated annual and seasonal survival rates of American black ducks by age and sex cohort derived using data from a pilot two-season banding program and dead recoveries, and Brownie $H_7$ model [@Brownie1985], 2009â€”2017.* 

```{r mall_results, eval = pooledH, cache = F}
plots.mall <- plotAndSumsSpEffect(sims.out.allspp$resultssum, "MALL", plotType="surv")
dev.off()
```

*Figure 5. Estimated annual and seasonal survival rates of mallards by age and sex cohort derived using data from a pilot two-season banding program and dead recoveries, and Brownie $H_7$ model [@Brownie1985], 2009â€”2017.* 

```{r hybrid_results, eval = pooledH, cache=F}
plots.hybr <- plotAndSumsSpEffect(sims.out.allspp$resultssum, "HYBR", plotType="surv")
dev.off()
```

*Figure 6. Estimated annual and seasonal survival rates of American black duck X mallard hybrids by age and sex cohort derived using data from a pilot two-season banding program and dead recoveries, and Brownie $H_7$ model [@Brownie1985], 2009â€”2017.* 

```{r all_recov}
plots.abdu.f <- plotAndSumsSpEffect(sims.out.allspp$resultssum, plotType="recov")
dev.off()
```

*Figure 7. Estimated recovery rates of American black ducks, mallards, and hybrids by age and sex cohort derived using data from a pilot two-season banding program and dead recoveries, and Brownie $H_7$ model [@Brownie1985], 2009â€”2017.* 

```{r abdu_all_together, eval = pooledH, cache=F}
## Set up data sets for plots
ABDU.Pre <- sims.out.preSS$resultssum[seq(1, 96, by=3),]
ABDU.Post <- sims.out.postSS$resultssum[seq(1, 84, by=3),]
ABDU.Both <- sims.out.allspp$resultssum[seq(193, 288, by=3),]

## Extract annual survival for all data sets
# Pre
ABDU.Pre$param<-"S"
# add year
year<-as.matrix(rep(2009:2016, length=32)) # for S
ABDU.Pre<-cbind(ABDU.Pre,year)
  
# add cohort
AM<-as.matrix(rep("AM",length=8))
AF<-as.matrix(rep("AF",length=8))
JM<-as.matrix(rep("JM",length=8))
JF<-as.matrix(rep("JF",length=8))
cohort<-rbind(AM,AF,JM,JF)
  
ABDU.Pre<-cbind(ABDU.Pre,cohort)
  
ABDU.Pre$spp <- "ABDU"
  
# Post
ABDU.Post$param<-"S"
# add year
year<-as.matrix(rep(2010:2016, length=28)) # for S
ABDU.Post<-cbind(ABDU.Post,year)
  
# add cohort
AM<-as.matrix(rep("AM",length=7))
AF<-as.matrix(rep("AF",length=7))
JM<-as.matrix(rep("JM",length=7))
JF<-as.matrix(rep("JF",length=7))
cohort<-rbind(AM,AF,JM,JF)
  
ABDU.Post<-cbind(ABDU.Post,cohort)
  
ABDU.Post$spp <- "ABDU"
  
# Both
ABDU.Both$param<-"S"
# add year
year<-as.matrix(rep(2009:2016, length=32)) # for S
ABDU.Both<-cbind(ABDU.Both,year)
  
# add cohort
AM<-as.matrix(rep("AM",length=8))
AF<-as.matrix(rep("AF",length=8))
JM<-as.matrix(rep("JM",length=8))
JF<-as.matrix(rep("JF",length=8))
cohort<-rbind(AM,AF,JM,JF)
  
ABDU.Both<-cbind(ABDU.Both,cohort)
  
ABDU.Both$spp <- "ABDU"
  
#### Plot ####
# create cohort specific data sets 
ABDU.AM.Pre<-subset(ABDU.Pre,cohort=="AM") 
ABDU.AF.Pre<-subset(ABDU.Pre,cohort=="AF")
ABDU.JM.Pre<-subset(ABDU.Pre,cohort=="JM")
ABDU.JF.Pre<-subset(ABDU.Pre,cohort=="JF")
ABDU.AM.Post<-subset(ABDU.Post,cohort=="AM") 
ABDU.AF.Post<-subset(ABDU.Post,cohort=="AF")
ABDU.JM.Post<-subset(ABDU.Post,cohort=="JM")
ABDU.JF.Post<-subset(ABDU.Post,cohort=="JF")
ABDU.AM.Both<-subset(ABDU.Both,cohort=="AM") 
ABDU.AF.Both<-subset(ABDU.Both,cohort=="AF")
ABDU.JM.Both<-subset(ABDU.Both,cohort=="JM")
ABDU.JF.Both<-subset(ABDU.Both,cohort=="JF")

library(gplots)
par(oma=c(4,1,1,1)) # make outer margin at the bottomm large to accomodate legend
  # Create the multi=panel figure.
  par(mfrow=c(2,2))
  # --- AM ---#
  plotCI(ABDU.AM.Both$year+0.25,
         y=ABDU.AM.Both$Median,
         uiw= ABDU.AM.Both$Upper95 - ABDU.AM.Both$Median,
         liw= ABDU.AM.Both$Median - ABDU.AM.Both$Lower95,
         gap=0.05,
         ylab="Annual Survival", 
         ylim=c(0,1), 
         xlim=c(2008.5,2016.5),
         xlab="Year",col="Black", 
         xaxt="n",
         cex.lab=0.78)
  axis(1, at=seq(2009,2016,1),las=1)
  title(main=paste0("ABDU", " Adult Male (AHY or ASY)"), cex.main=0.8)
  
  par(new=T)
  
  plotCI(x=ABDU.AM.Pre$year-0.25,
         y=ABDU.AM.Pre$Median,
         uiw= ABDU.AM.Pre$Upper95 - ABDU.AM.Pre$Median,
         liw= ABDU.AM.Pre$Median - ABDU.AM.Pre$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Orange")
  
  par(new=T)
  
  plotCI(x= ABDU.AM.Post$year,
         y= ABDU.AM.Post$Median,
         uiw= ABDU.AM.Post$Upper95 - ABDU.AM.Post$Median,
         liw= ABDU.AM.Post$Median - ABDU.AM.Post$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Blue")
  
  # --- ---- AF --- ---- #
  
  plotCI(ABDU.AF.Both$year+0.25,
         y=ABDU.AF.Both$Median,
         uiw=ABDU.AF.Both$Upper95 - ABDU.AF.Both$Median,
         liw=ABDU.AF.Both$Median - ABDU.AF.Both$Lower95,
         gap=0.05,
         ylab="Annual Survival", 
         ylim=c(0,1), 
         xlim=c(2008.5,2016.5),
         xlab="Year",col="Black", 
         xaxt="n",
         cex.lab=0.78)
  axis(1, at=seq(2009,2016,1),las=1)
  title(main=paste0("ABDU", " Adult Female (AHY or ASY)"), cex.main=0.8)
  
  par(new=T)
  
  plotCI(x=ABDU.AF.Pre$year-0.25,
         y=ABDU.AF.Pre$Median,
         uiw=ABDU.AF.Pre$Upper95 - ABDU.AF.Pre$Median,
         liw=ABDU.AF.Pre$Median - ABDU.AF.Pre$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Orange")
  
  par(new=T)
  
  plotCI(x=ABDU.AF.Post$year,
         y=ABDU.AF.Post$Median,
         uiw=ABDU.AF.Post$Upper95 - ABDU.AF.Post$Median,
         liw=ABDU.AF.Post$Median - ABDU.AF.Post$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Blue")
  
  # --- ---- JM --- ---- #
  
  plotCI(ABDU.JM.Both$year+0.25,
         y=ABDU.JM.Both$Median,
         uiw=ABDU.JM.Both$Upper95-ABDU.JM.Both$Median,
         liw=ABDU.JM.Both$Median-ABDU.JM.Both$Lower95,
         gap=0.05,
         ylab="Annual Survival", 
         ylim=c(0,1), 
         xlim=c(2008.5,2016.5),
         xlab="Year",col="Black", 
         xaxt="n",
         cex.lab=0.78)
  axis(1, at=seq(2009,2016,1),las=1)
  title(main=paste0("ABDU", " Juvenile Male (HY or SY)"), cex.main=0.8)
  
  par(new=T)
  
  plotCI(x=ABDU.JM.Pre$year-0.25,
         y=ABDU.JM.Pre$Median,
         uiw=ABDU.JM.Pre$Upper95 - ABDU.JM.Pre$Median,
         liw=ABDU.JM.Pre$Median - ABDU.JM.Pre$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Orange")
  
  par(new=T)
  
  plotCI(x=ABDU.JM.Post$year,
         y=ABDU.JM.Post$Median,
         uiw=ABDU.JM.Post$Upper95 - ABDU.JM.Post$Median,
         liw=ABDU.JM.Post$Median - ABDU.JM.Post$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Blue")
  
  
  # --- ---- JF --- ---- #
  
  plotCI(ABDU.JF.Both$year+0.25,
         y=ABDU.JF.Both$Median,
         uiw=ABDU.JF.Both$Upper95 - ABDU.JF.Both$Median,
         liw=ABDU.JF.Both$Median - ABDU.JF.Both$Lower95,
         gap=0.05,
         ylab="Annual Survival", 
         ylim=c(0,1), 
         xlim=c(2008.5,2016.5),
         xlab="Year",col="Black", 
         xaxt="n",
         cex.lab=0.78)
  axis(1, at=seq(2009,2016,1),las=1)
  title(main=paste0("ABDU", " Juvenile Female (HY or SY)"), cex.main=0.8)
  
  par(new=T)
  
  plotCI(x=ABDU.JF.Pre$year-0.25,
         y=ABDU.JF.Pre$Median,
         uiw=ABDU.JF.Pre$Upper95 - ABDU.JF.Pre$Median,
         liw=ABDU.JF.Pre$Median - ABDU.JF.Pre$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Orange")
  
  par(new=T)
  
  plotCI(x=ABDU.JF.Post$year,
         y=ABDU.JF.Post$Median,
         uiw=ABDU.JF.Post$Upper95 - ABDU.JF.Post$Median,
         liw=ABDU.JF.Post$Median - ABDU.JF.Post$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Blue")
  
  #overlay the entire region with a new single plot, then #call legend  with the location (e.g., "bottom")
  par(fig = c(0,1,0,1), oma=c(0,0,0,0), mar=c(0,0,0,0), new=TRUE)
  plot(0,0,type="n",bty="n", xaxt="n",yaxt="n")
  legend("bottom",c("Annual Survival (pre-season)",
                    "Annual Survival (post-season)",
                    "Annual Survival (both)"),
         xpd=TRUE,
         hori=TRUE,
         inset=c(0,0),
         bty="n",
         lty=c(1,1,1),
         col=c("Orange","blue","black"))
dev.off()
```

*Figure 8. Comparison of estimated annual survival of American black ducks by model and data type, 2009â€”2017. *


```{r mall_all_together, eval = pooledH, cache=F}
MALL.Pre <- sims.out.preSS$resultssum[seq(3, 96, by=3),]
MALL.Post <- sims.out.postSS$resultssum[seq(3, 84, by=3),]
MALL.Both <- sims.out.allspp$resultssum[seq(195, 288, by=3),]

## Extract annual survival for all data sets
# Pre
MALL.Pre$param<-"S"
# add year
year<-as.matrix(rep(2009:2016, length=32)) # for S
MALL.Pre<-cbind(MALL.Pre,year)
  
# add cohort
AM<-as.matrix(rep("AM",length=8))
AF<-as.matrix(rep("AF",length=8))
JM<-as.matrix(rep("JM",length=8))
JF<-as.matrix(rep("JF",length=8))
cohort<-rbind(AM,AF,JM,JF)
  
MALL.Pre<-cbind(MALL.Pre,cohort)
  
MALL.Pre$spp <- "MALL"
  
# Post
MALL.Post$param<-"S"
# add year
year<-as.matrix(rep(2010:2016, length=28)) # for S
MALL.Post<-cbind(MALL.Post,year)
  
# add cohort
AM<-as.matrix(rep("AM",length=7))
AF<-as.matrix(rep("AF",length=7))
JM<-as.matrix(rep("JM",length=7))
JF<-as.matrix(rep("JF",length=7))
cohort<-rbind(AM,AF,JM,JF)
  
MALL.Post<-cbind(MALL.Post,cohort)
  
MALL.Post$spp <- "MALL"
  
# Both
MALL.Both$param<-"S"
# add year
year<-as.matrix(rep(2009:2016, length=32)) # for S
MALL.Both<-cbind(MALL.Both,year)
  
# add cohort
AM<-as.matrix(rep("AM",length=8))
AF<-as.matrix(rep("AF",length=8))
JM<-as.matrix(rep("JM",length=8))
JF<-as.matrix(rep("JF",length=8))
cohort<-rbind(AM,AF,JM,JF)
  
MALL.Both<-cbind(MALL.Both,cohort)
  
MALL.Both$spp <- "MALL"
  
#### Plot ####
# create cohort specific data sets 
MALL.AM.Pre<-subset(MALL.Pre,cohort=="AM") 
MALL.AF.Pre<-subset(MALL.Pre,cohort=="AF")
MALL.JM.Pre<-subset(MALL.Pre,cohort=="JM")
MALL.JF.Pre<-subset(MALL.Pre,cohort=="JF")
MALL.AM.Post<-subset(MALL.Post,cohort=="AM") 
MALL.AF.Post<-subset(MALL.Post,cohort=="AF")
MALL.JM.Post<-subset(MALL.Post,cohort=="JM")
MALL.JF.Post<-subset(MALL.Post,cohort=="JF")
MALL.AM.Both<-subset(MALL.Both,cohort=="AM") 
MALL.AF.Both<-subset(MALL.Both,cohort=="AF")
MALL.JM.Both<-subset(MALL.Both,cohort=="JM")
MALL.JF.Both<-subset(MALL.Both,cohort=="JF")

library(gplots)
par(oma=c(4,1,1,1)) # make outer margin at the bottomm large to accomodate legend
  # Create the multi=panel figure.
  par(mfrow=c(2,2))
  # --- AM ---#
  plotCI(MALL.AM.Both$year+0.25,
         y=MALL.AM.Both$Median,
         uiw= MALL.AM.Both$Upper95 - MALL.AM.Both$Median,
         liw= MALL.AM.Both$Median - MALL.AM.Both$Lower95,
         gap=0.05,
         ylab="Annual Survival", 
         ylim=c(0,1), 
         xlim=c(2008.5,2016.5),
         xlab="Year",col="Black", 
         xaxt="n",
         cex.lab=0.78)
  axis(1, at=seq(2009,2016,1),las=1)
  title(main=paste0("MALL", " Adult Male (AHY or ASY)"), cex.main=0.8)
  
  par(new=T)
  
  plotCI(x=MALL.AM.Pre$year-0.25,
         y=MALL.AM.Pre$Median,
         uiw= MALL.AM.Pre$Upper95 - MALL.AM.Pre$Median,
         liw= MALL.AM.Pre$Median - MALL.AM.Pre$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Orange")
  
  par(new=T)
  
  plotCI(x= MALL.AM.Post$year,
         y= MALL.AM.Post$Median,
         uiw= MALL.AM.Post$Upper95 - MALL.AM.Post$Median,
         liw= MALL.AM.Post$Median - MALL.AM.Post$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Blue")
  
  # --- ---- AF --- ---- #
  
  plotCI(MALL.AF.Both$year+0.25,
         y=MALL.AF.Both$Median,
         uiw=MALL.AF.Both$Upper95 - MALL.AF.Both$Median,
         liw=MALL.AF.Both$Median - MALL.AF.Both$Lower95,
         gap=0.05,
         ylab="Annual Survival", 
         ylim=c(0,1), 
         xlim=c(2008.5,2016.5),
         xlab="Year",col="Black", 
         xaxt="n",
         cex.lab=0.78)
  axis(1, at=seq(2009,2016,1),las=1)
  title(main=paste0("MALL", " Adult Female (AHY or ASY)"), cex.main=0.8)
  
  par(new=T)
  
  plotCI(x=MALL.AF.Pre$year-0.25,
         y=MALL.AF.Pre$Median,
         uiw=MALL.AF.Pre$Upper95 - MALL.AF.Pre$Median,
         liw=MALL.AF.Pre$Median - MALL.AF.Pre$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Orange")
  
  par(new=T)
  
  plotCI(x=MALL.AF.Post$year,
         y=MALL.AF.Post$Median,
         uiw=MALL.AF.Post$Upper95 - MALL.AF.Post$Median,
         liw=MALL.AF.Post$Median - MALL.AF.Post$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Blue")
  
  # --- ---- JM --- ---- #
  
  plotCI(MALL.JM.Both$year+0.25,
         y=MALL.JM.Both$Median,
         uiw=MALL.JM.Both$Upper95-MALL.JM.Both$Median,
         liw=MALL.JM.Both$Median-MALL.JM.Both$Lower95,
         gap=0.05,
         ylab="Annual Survival", 
         ylim=c(0,1), 
         xlim=c(2008.5,2016.5),
         xlab="Year",col="Black", 
         xaxt="n",
         cex.lab=0.78)
  axis(1, at=seq(2009,2016,1),las=1)
  title(main=paste0("MALL", " Juvenile Male (HY or SY)"), cex.main=0.8)
  
  par(new=T)
  
  plotCI(x=MALL.JM.Pre$year-0.25,
         y=MALL.JM.Pre$Median,
         uiw=MALL.JM.Pre$Upper95 - MALL.JM.Pre$Median,
         liw=MALL.JM.Pre$Median - MALL.JM.Pre$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Orange")
  
  par(new=T)
  
  plotCI(x=MALL.JM.Post$year,
         y=MALL.JM.Post$Median,
         uiw=MALL.JM.Post$Upper95 - MALL.JM.Post$Median,
         liw=MALL.JM.Post$Median - MALL.JM.Post$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Blue")
  
  
  # --- ---- JF --- ---- #
  
  plotCI(MALL.JF.Both$year+0.25,
         y=MALL.JF.Both$Median,
         uiw=MALL.JF.Both$Upper95 - MALL.JF.Both$Median,
         liw=MALL.JF.Both$Median - MALL.JF.Both$Lower95,
         gap=0.05,
         ylab="Annual Survival", 
         ylim=c(0,1), 
         xlim=c(2008.5,2016.5),
         xlab="Year",col="Black", 
         xaxt="n",
         cex.lab=0.78)
  axis(1, at=seq(2009,2016,1),las=1)
  title(main=paste0("MALL", " Juvenile Female (HY or SY)"), cex.main=0.8)
  
  par(new=T)
  
  plotCI(x=MALL.JF.Pre$year-0.25,
         y=MALL.JF.Pre$Median,
         uiw=MALL.JF.Pre$Upper95 - MALL.JF.Pre$Median,
         liw=MALL.JF.Pre$Median - MALL.JF.Pre$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Orange")
  
  par(new=T)
  
  plotCI(x=MALL.JF.Post$year,
         y=MALL.JF.Post$Median,
         uiw=MALL.JF.Post$Upper95 - MALL.JF.Post$Median,
         liw=MALL.JF.Post$Median - MALL.JF.Post$Lower95,
         gap=0.05, 
         ann=FALSE,
         add=T, 
         col="Blue")
  
  #overlay the entire region with a new single plot, then #call legend  with the location (e.g., "bottom")
  par(fig = c(0,1,0,1), oma=c(0,0,0,0), mar=c(0,0,0,0), new=TRUE)
  plot(0,0,type="n",bty="n", xaxt="n",yaxt="n")
  legend("bottom",c("Annual Survival (pre-season)",
                    "Annual Survival (post-season)",
                    "Annual Survival (both)"),
         xpd=TRUE,
         hori=TRUE,
         inset=c(0,0),
         bty="n",
         lty=c(1,1,1),
         col=c("Orange","blue","black"))
dev.off()
```

*Figure 9. Comparison of estimated annual survival of mallards by model and data type, 2009â€”2017.* 

# References